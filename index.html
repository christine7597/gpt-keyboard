<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT Keyboard - ì‹¬ë¦¬í•™ íŠ¹í™” AI í‚¤ë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .api-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .api-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1em;
        }

        input[type="text"],
        input[type="password"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .keyboard-area {
            margin-top: 30px;
        }

        .keyboard-area h3 {
            color: #333;
            margin-bottom: 15px;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .suggestions {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .suggestions h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .suggestion-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }

        .suggestion-item:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            line-height: 1.5;
        }

        .info-text a {
            color: #667eea;
            text-decoration: none;
        }

        .info-text a:hover {
            text-decoration: underline;
        }

        .char-count {
            text-align: right;
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            color: #667eea;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .emotion-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .emotion-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .emotion-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .emotion-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .psychology-connection {
            margin-top: 20px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .psychology-connection h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .connection-item {
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .connection-item strong {
            color: #667eea;
        }

        .recommendations {
            margin-top: 20px;
            padding: 20px;
            background: #fff5f5;
            border-radius: 12px;
            border-left: 4px solid #ff6b9d;
        }

        .recommendations h4 {
            color: #ff6b9d;
            margin-bottom: 15px;
        }

        .recommendation-item {
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recommendation-item:hover {
            background: #ff6b9d;
            color: white;
            transform: translateX(5px);
        }

        .diary-list {
            margin-top: 20px;
        }

        .diary-entry {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .diary-entry .date {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .diary-entry .emotion-tag {
            display: inline-block;
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âŒ¨ï¸ GPT Keyboard</h1>
            <p>ì‹¬ë¦¬í•™ íŠ¹í™” AI í‚¤ë³´ë“œ - ì‹¬ë¦¬í•™ ì „ë¬¸ê°€ë¥¼ ìœ„í•œ ìŠ¤ë§ˆíŠ¸ í…ìŠ¤íŠ¸ ì…ë ¥</p>
        </div>

        <div class="main-card">
            <div class="api-section">
                <h3>ğŸ”‘ OpenAI API ì„¤ì •</h3>
                <div class="form-group">
                    <label for="apiKey">OpenAI API Key (ì„ íƒì‚¬í•­)</label>
                    <input type="password" id="apiKey" placeholder="sk-... (API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ GPT ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥)">
                    <div class="info-text">
                        API í‚¤ê°€ ì—†ì–´ë„ ê¸°ë³¸ ìë™ì™„ì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                        API í‚¤ëŠ” <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a>ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveApiKey()">API í‚¤ ì €ì¥</button>
                <div id="apiStatus"></div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('keyboard')">âŒ¨ï¸ ì‹¬ë¦¬í•™ í‚¤ë³´ë“œ</button>
                <button class="tab-btn" onclick="showTab('diary')">ğŸ“” ê°ì • ì¼ê¸°</button>
            </div>

            <!-- ì‹¬ë¦¬í•™ í‚¤ë³´ë“œ íƒ­ -->
            <div id="keyboard" class="tab-content active">
                <div class="keyboard-area">
                    <h3>âœï¸ í…ìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <textarea id="textInput" placeholder="ì‹¬ë¦¬í•™ ê´€ë ¨ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...&#10;&#10;ì˜ˆ: ì¸ì§€ í–‰ë™ ì¹˜ë£Œ, ê³µê°ì  ëŒ€ì‘, ê°ì • ì¡°ì ˆ ë“±&#10;ì…ë ¥í•˜ë©´ AIê°€ ì‹¬ë¦¬í•™ ì „ë¬¸ê°€ ê´€ì ì—ì„œ ì œì•ˆì„ ì œê³µí•©ë‹ˆë‹¤."></textarea>
                        <div class="char-count">
                            <span id="charCount">0</span> ê¸€ì
                        </div>
                    </div>

                    <div class="suggestions" id="suggestions" style="display: none;">
                        <h4>ğŸ’¡ AI ì œì•ˆ</h4>
                        <div id="suggestionList"></div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="getAISuggestion()">ğŸ¤– AI ì œì•ˆ ë°›ê¸°</button>
                        <button class="btn btn-secondary" onclick="clearText()">ì§€ìš°ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ê°ì • ì¼ê¸° íƒ­ -->
            <div id="diary" class="tab-content">
                <h3>ğŸ“” ì˜¤ëŠ˜ì˜ ê°ì • ì¼ê¸°</h3>
                
                <div class="form-group">
                    <label>ì˜¤ëŠ˜ì˜ ê°ì •ì„ ì„ íƒí•˜ì„¸ìš”</label>
                    <div class="emotion-selector" id="emotionSelector">
                        <div class="emotion-btn" onclick="selectEmotion('ê¸°ì¨')">ğŸ˜Š ê¸°ì¨</div>
                        <div class="emotion-btn" onclick="selectEmotion('ìŠ¬í””')">ğŸ˜¢ ìŠ¬í””</div>
                        <div class="emotion-btn" onclick="selectEmotion('í™”ë‚¨')">ğŸ˜  í™”ë‚¨</div>
                        <div class="emotion-btn" onclick="selectEmotion('ë¶ˆì•ˆ')">ğŸ˜° ë¶ˆì•ˆ</div>
                        <div class="emotion-btn" onclick="selectEmotion('í‰ì˜¨')">ğŸ˜Œ í‰ì˜¨</div>
                        <div class="emotion-btn" onclick="selectEmotion('í”¼ê³¤')">ğŸ˜´ í”¼ê³¤</div>
                        <div class="emotion-btn" onclick="selectEmotion('í¥ë¯¸')">ğŸ¤” í¥ë¯¸</div>
                        <div class="emotion-btn" onclick="selectEmotion('ì‚¬ë‘')">â¤ï¸ ì‚¬ë‘</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="diaryInput">ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”? ê¸°ë¶„ì´ë‚˜ ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”.</label>
                    <textarea id="diaryInput" placeholder="ì˜¤ëŠ˜ì˜ ê°ì •ê³¼ ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”...&#10;&#10;ì˜ˆ: ì˜¤ëŠ˜ íšŒì˜ì—ì„œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§ì´ ë°›ì•˜ì–´ìš”. ê³„ì† ë¶ˆì•ˆí•œ ê¸°ë¶„ì´ ë“¤ê³ ..."></textarea>
                    <div class="char-count">
                        <span id="diaryCharCount">0</span> ê¸€ì
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="saveDiary()">ğŸ’¾ ì¼ê¸° ì €ì¥</button>
                    <button class="btn btn-primary" onclick="analyzeEmotion()">ğŸ” ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„</button>
                    <button class="btn btn-secondary" onclick="clearDiary()">ì§€ìš°ê¸°</button>
                </div>

                <div class="psychology-connection" id="psychologyConnection" style="display: none;">
                    <h4>ğŸ§  ì‹¬ë¦¬í•™ì  ì—°ê²°</h4>
                    <div id="connectionList"></div>
                </div>

                <div class="recommendations" id="recommendations" style="display: none;">
                    <h4>ğŸ“š ì¶”ì²œ ì½˜í…ì¸ </h4>
                    <div id="recommendationList"></div>
                </div>

                <div class="diary-list" id="diaryList" style="display: none;">
                    <h3 style="margin-top: 30px; margin-bottom: 15px;">ğŸ“– ì €ì¥ëœ ì¼ê¸°</h3>
                    <div id="diaryEntries"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKeyInput = document.getElementById('apiKey');
        const textInput = document.getElementById('textInput');
        const suggestionsDiv = document.getElementById('suggestions');
        const suggestionList = document.getElementById('suggestionList');
        const charCount = document.getElementById('charCount');
        const apiStatus = document.getElementById('apiStatus');
        
        // ê°ì • ì¼ê¸° ê´€ë ¨
        const diaryInput = document.getElementById('diaryInput');
        const diaryCharCount = document.getElementById('diaryCharCount');
        let selectedEmotion = null;

        // ì €ì¥ëœ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
        const savedApiKey = localStorage.getItem('gpt_keyboard_api_key');
        if (savedApiKey) {
            apiKeyInput.value = savedApiKey;
            showStatus('API í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.', 'success');
        }

        // API í‚¤ ì €ì¥
        function saveApiKey() {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem('gpt_keyboard_api_key', apiKey);
                showStatus('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                localStorage.removeItem('gpt_keyboard_api_key');
                showStatus('API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        // ìƒíƒœ í‘œì‹œ
        function showStatus(message, type) {
            apiStatus.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => {
                apiStatus.innerHTML = '';
            }, 3000);
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'diary') {
                loadDiaries();
            }
        }

        // ê°ì • ì„ íƒ
        function selectEmotion(emotion) {
            selectedEmotion = emotion;
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // ê¸€ì ìˆ˜ ì¹´ìš´íŠ¸
        textInput.addEventListener('input', (e) => {
            charCount.textContent = e.target.value.length;
            // ì…ë ¥ ì¤‘ì¼ ë•Œ ê¸°ë³¸ ì œì•ˆ í‘œì‹œ
            if (e.target.value.length > 0) {
                showBasicSuggestions(e.target.value);
            } else {
                suggestionsDiv.style.display = 'none';
            }
        });

        diaryInput.addEventListener('input', (e) => {
            diaryCharCount.textContent = e.target.value.length;
        });

        // ê¸°ë³¸ ì œì•ˆ (API í‚¤ ì—†ì„ ë•Œ)
        function showBasicSuggestions(text) {
            const suggestions = generateBasicSuggestions(text);
            if (suggestions.length > 0) {
                displaySuggestions(suggestions);
            }
        }

        // ê¸°ë³¸ ì œì•ˆ ìƒì„± (ì‹¬ë¦¬í•™ íŠ¹í™”)
        function generateBasicSuggestions(text) {
            const suggestions = [];
            const lastWord = text.trim().split(/\s+/).pop().toLowerCase();
            
            // ì‹¬ë¦¬í•™ ê´€ë ¨ ìš©ì–´ ì™„ì„±
            const psychologyTerms = {
                'ì¸ì§€': ['ì¸ì§€ í–‰ë™ ì¹˜ë£Œ', 'ì¸ì§€ í–‰ë™ ì¹˜ë£Œ(CBT)', 'ì¸ì§€ ì™œê³¡'],
                'ê³µê°': ['ê³µê°ì  ëŒ€ì‘', 'ê³µê°í•˜ê¸°', 'ê³µê° ëŠ¥ë ¥'],
                'ê°ì •': ['ê°ì • ì¡°ì ˆ', 'ê°ì • ì¸ì‹', 'ê°ì • í‘œí˜„'],
                'ìŠ¤íŠ¸ë ˆìŠ¤': ['ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬', 'ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™”', 'ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì²˜'],
                'ë§ˆìŒì±™ê¹€': ['ë§ˆìŒì±™ê¹€ ëª…ìƒ', 'ë§ˆìŒì±™ê¹€ ì—°ìŠµ', 'ë§ˆìŒì±™ê¹€ ê¸°ë²•'],
                'ìì¡´ê°': ['ìì¡´ê° í–¥ìƒ', 'ìì¡´ê° í‚¤ìš°ê¸°', 'ìì¡´ê° íšŒë³µ'],
                'ë¶ˆì•ˆ': ['ë¶ˆì•ˆ ê´€ë¦¬', 'ë¶ˆì•ˆ ì™„í™”', 'ë¶ˆì•ˆ ëŒ€ì²˜'],
                'ìš°ìš¸': ['ìš°ìš¸ì¦', 'ìš°ìš¸ê°', 'ìš°ìš¸ ì¦ìƒ'],
                'ìƒë‹´': ['ìƒë‹´ ê³¼ì •', 'ìƒë‹´ ê¸°ë²•', 'ìƒë‹´ ì ‘ê·¼'],
                'ì¹˜ë£Œ': ['ì¹˜ë£Œ íš¨ê³¼', 'ì¹˜ë£Œ ê³¼ì •', 'ì¹˜ë£Œ ê¸°ë²•'],
                'íŠ¸ë¼ìš°ë§ˆ': ['íŠ¸ë¼ìš°ë§ˆ ì¹˜ë£Œ', 'íŠ¸ë¼ìš°ë§ˆ íšŒë³µ', 'íŠ¸ë¼ìš°ë§ˆ ëŒ€ì²˜'],
                'ì• ì°©': ['ì• ì°© ì´ë¡ ', 'ì• ì°© ìœ í˜•', 'ì• ì°© ê´€ê³„'],
                'ìê¸°íš¨ëŠ¥ê°': ['ìê¸°íš¨ëŠ¥ê° í–¥ìƒ', 'ìê¸°íš¨ëŠ¥ê°', 'ìê¸°íš¨ëŠ¥ê° ì¦ì§„'],
                'íšŒë³µíƒ„ë ¥ì„±': ['íšŒë³µíƒ„ë ¥ì„±', 'íšŒë³µíƒ„ë ¥ì„± í–¥ìƒ', 'íšŒë³µíƒ„ë ¥ì„± ê¸°ë¥´ê¸°']
            };

            for (const [key, values] of Object.entries(psychologyTerms)) {
                if (lastWord.startsWith(key) || key.startsWith(lastWord)) {
                    values.forEach(val => {
                        if (!suggestions.includes(val)) {
                            suggestions.push(val);
                        }
                    });
                }
            }

            // ë¬¸ì¥ ì™„ì„± ì œì•ˆ
            if (text.endsWith(' ')) {
                suggestions.push('ê³„ì† ì…ë ¥í•˜ì„¸ìš”...');
            }

            return suggestions.slice(0, 3);
        }

        // AI ì œì•ˆ ë°›ê¸°
        async function getAISuggestion() {
            const text = textInput.value.trim();
            if (!text) {
                showStatus('í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const apiKey = localStorage.getItem('gpt_keyboard_api_key');
            
            if (!apiKey) {
                // API í‚¤ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì œì•ˆë§Œ í‘œì‹œ
                showBasicSuggestions(text);
                showStatus('API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ì‹¬ë¦¬í•™ ì „ë¬¸ê°€ ìˆ˜ì¤€ì˜ ì œì•ˆì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'info');
                return;
            }

            // API í‚¤ê°€ ìˆìœ¼ë©´ GPT ì‚¬ìš©
            suggestionsDiv.style.display = 'block';
            suggestionList.innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">AIê°€ ì œì•ˆì„ ìƒì„±í•˜ëŠ” ì¤‘...</div>';

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'ë‹¹ì‹ ì€ ì‹¬ë¦¬í•™ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì‹¬ë¦¬í•™ ê´€ë ¨ í…ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì´ê³  ìì—°ìŠ¤ëŸ¬ìš´ ë‹¤ìŒ ë¬¸ì¥ì´ë‚˜ ìš©ì–´ë¥¼ 3ê°œ ì œì•ˆí•´ì£¼ì„¸ìš”. ê° ì œì•ˆì€ ì‹¬ë¦¬í•™ ì „ë¬¸ê°€ ê´€ì ì—ì„œ ì •í™•í•˜ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.'
                            },
                            {
                                role: 'user',
                                content: `ë‹¤ìŒ ì‹¬ë¦¬í•™ ê´€ë ¨ í…ìŠ¤íŠ¸ì— ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ì „ë¬¸ì ì¸ ì œì•ˆì„ 3ê°œ í•´ì£¼ì„¸ìš”: "${text}"`
                            }
                        ],
                        max_tokens: 100,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                }

                const data = await response.json();
                const suggestions = data.choices[0].message.content
                    .split('\n')
                    .filter(line => line.trim().length > 0)
                    .map(line => line.replace(/^\d+\.\s*/, '').replace(/^[-*]\s*/, '').trim())
                    .slice(0, 3);

                displaySuggestions(suggestions);
            } catch (error) {
                console.error('Error:', error);
                showBasicSuggestions(text);
                showStatus('API ìš”ì²­ ì‹¤íŒ¨. ê¸°ë³¸ ì œì•ˆì„ í‘œì‹œí•©ë‹ˆë‹¤.', 'error');
            }
        }

        // ì œì•ˆ í‘œì‹œ
        function displaySuggestions(suggestions) {
            if (suggestions.length === 0) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            suggestionsDiv.style.display = 'block';
            suggestionList.innerHTML = suggestions.map(suggestion => 
                `<div class="suggestion-item" onclick="applySuggestion('${suggestion.replace(/'/g, "\\'")}')">${suggestion}</div>`
            ).join('');
        }

        // ì œì•ˆ ì ìš©
        function applySuggestion(suggestion) {
            const currentText = textInput.value;
            textInput.value = currentText + (currentText.endsWith(' ') ? '' : ' ') + suggestion;
            charCount.textContent = textInput.value.length;
            suggestionsDiv.style.display = 'none';
            textInput.focus();
        }

        // í…ìŠ¤íŠ¸ ì§€ìš°ê¸°
        function clearText() {
            textInput.value = '';
            charCount.textContent = '0';
            suggestionsDiv.style.display = 'none';
        }

        // ì´ˆê¸° ê¸€ì ìˆ˜ í‘œì‹œ
        charCount.textContent = textInput.value.length;
        diaryCharCount.textContent = diaryInput.value.length;

        // ê°ì • ì¼ê¸° ì €ì¥
        function saveDiary() {
            const emotion = selectedEmotion;
            const content = diaryInput.value.trim();
            
            if (!emotion) {
                showStatus('ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (!content) {
                showStatus('ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const diary = {
                id: Date.now(),
                date: new Date().toLocaleDateString('ko-KR'),
                emotion: emotion,
                content: content,
                timestamp: new Date().toISOString()
            };

            const diaries = JSON.parse(localStorage.getItem('gpt_keyboard_diaries') || '[]');
            diaries.unshift(diary);
            localStorage.setItem('gpt_keyboard_diaries', JSON.stringify(diaries));

            showStatus('ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            clearDiary();
            loadDiaries();
        }

        // ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„
        async function analyzeEmotion() {
            const emotion = selectedEmotion;
            const content = diaryInput.value.trim();
            
            if (!emotion || !content) {
                showStatus('ê°ì •ê³¼ ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const connectionDiv = document.getElementById('psychologyConnection');
            const connectionList = document.getElementById('connectionList');
            const recommendationsDiv = document.getElementById('recommendations');
            const recommendationList = document.getElementById('recommendationList');

            connectionDiv.style.display = 'block';
            connectionList.innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">ë¶„ì„ ì¤‘...</div>';

            // ê°ì •ê³¼ ë‚´ìš© ê¸°ë°˜ ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„
            const connections = analyzePsychologyConnection(emotion, content);
            connectionList.innerHTML = connections.map(conn => 
                `<div class="connection-item">
                    <strong>${conn.term}:</strong> ${conn.description}
                </div>`
            ).join('');

            // ì¶”ì²œ ì½˜í…ì¸  ìƒì„±
            recommendationsDiv.style.display = 'block';
            const recommendations = getRecommendations(emotion, content);
            recommendationList.innerHTML = recommendations.map(rec => 
                `<div class="recommendation-item" onclick="window.open('${rec.url}', '_blank')">
                    <strong>${rec.type}:</strong> ${rec.title}
                </div>`
            ).join('');
        }

        // ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„ í•¨ìˆ˜
        function analyzePsychologyConnection(emotion, content) {
            const connections = [];
            const text = content.toLowerCase();

            // ê°ì • ê¸°ë°˜ ì—°ê²°
            const emotionConnections = {
                'ë¶ˆì•ˆ': [
                    { term: 'ë¶ˆì•ˆì¥ì• ', description: 'ì§€ì†ì ì¸ ë¶ˆì•ˆê°ì€ ë¶ˆì•ˆì¥ì• ì™€ ê´€ë ¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§ˆìŒì±™ê¹€ ëª…ìƒì´ë‚˜ ì¸ì§€ í–‰ë™ ì¹˜ë£Œê°€ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”.' },
                    { term: 'ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì²˜', description: 'ë¶ˆì•ˆì€ ìŠ¤íŠ¸ë ˆìŠ¤ì™€ ë°€ì ‘í•œ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ê¹Šì€ í˜¸í¡ì´ë‚˜ ì ì§„ì  ê·¼ìœ¡ ì´ì™„ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”.' }
                ],
                'ìŠ¬í””': [
                    { term: 'ìš°ìš¸ê°', description: 'ì§€ì†ì ì¸ ìŠ¬í””ì€ ìš°ìš¸ê°ê³¼ ì—°ê²°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ì •ì„ ì¸ì •í•˜ê³  í‘œí˜„í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.' },
                    { term: 'ê°ì • ì¡°ì ˆ', description: 'ìŠ¬í””ì„ ê±´ê°•í•˜ê²Œ ë‹¤ë£¨ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê°ì • ì¼ê¸°ë‚˜ ìƒë‹´ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.' }
                ],
                'í™”ë‚¨': [
                    { term: 'ë¶„ë…¸ ê´€ë¦¬', description: 'í™”ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ê°ì •ì´ì§€ë§Œ, ê±´ê°•í•˜ê²Œ í‘œí˜„í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.' },
                    { term: 'ê°ì • ì¸ì‹', description: 'í™”ê°€ ë‚˜ëŠ” ì´ìœ ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ê°ì • ì¡°ì ˆì˜ ì²« ë‹¨ê³„ì…ë‹ˆë‹¤.' }
                ],
                'ê¸°ì¨': [
                    { term: 'ê¸ì • ì‹¬ë¦¬í•™', description: 'ê¸°ì¨ì„ ëŠë¼ëŠ” ìˆœê°„ì„ ê¸°ë¡í•˜ê³  ë˜ìƒˆê¸°ëŠ” ê²ƒì´ í–‰ë³µì„ ì¦ì§„ì‹œí‚¬ ìˆ˜ ìˆì–´ìš”.' },
                    { term: 'ê°ì‚¬ í‘œí˜„', description: 'ê¸°ì¨ì„ ëŠë‚„ ë•Œ ê°ì‚¬ë¥¼ í‘œí˜„í•˜ë©´ ë” ì˜¤ë˜ ì§€ì†ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' }
                ]
            };

            if (emotionConnections[emotion]) {
                connections.push(...emotionConnections[emotion]);
            }

            // ë‚´ìš© ê¸°ë°˜ ì—°ê²°
            if (text.includes('ìŠ¤íŠ¸ë ˆìŠ¤') || text.includes('ì••ë°•')) {
                connections.push({ term: 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬', description: 'ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ì •ì‹  ê±´ê°•ì— í° ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ê·œì¹™ì ì¸ ìš´ë™, ì¶©ë¶„í•œ ìˆ˜ë©´, íœ´ì‹ì´ ì¤‘ìš”í•´ìš”.' });
            }
            if (text.includes('ë¶ˆì•ˆ') || text.includes('ê±±ì •')) {
                connections.push({ term: 'ë¶ˆì•ˆ ê´€ë¦¬ ê¸°ë²•', description: 'ë§ˆìŒì±™ê¹€ ëª…ìƒ, í˜¸í¡ ìš´ë™, ì¸ì§€ ì¬êµ¬ì„±ì´ ë¶ˆì•ˆ ì™„í™”ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.' });
            }
            if (text.includes('ê´€ê³„') || text.includes('ì‚¬ëŒ')) {
                connections.push({ term: 'ëŒ€ì¸ê´€ê³„ ì‹¬ë¦¬í•™', description: 'ê±´ê°•í•œ ê´€ê³„ëŠ” ì •ì‹  ê±´ê°•ì˜ ê¸°ì´ˆì…ë‹ˆë‹¤. ê²½ê³„ ì„¤ì •ê³¼ íš¨ê³¼ì ì¸ ì†Œí†µì´ ì¤‘ìš”í•´ìš”.' });
            }
            if (text.includes('ìì‹ ') || text.includes('ìì¡´ê°')) {
                connections.push({ term: 'ìì¡´ê°', description: 'ìì¡´ê°ì€ ìì‹ ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ë°›ì•„ë“¤ì´ëŠ” ê²ƒì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤. ìê¸° ìì‹ ì—ê²Œ ì¹œì ˆí•˜ê²Œ ëŒ€í•˜ì„¸ìš”.' });
            }
            if (text.includes('ê³¼ê±°') || text.includes('íŠ¸ë¼ìš°ë§ˆ')) {
                connections.push({ term: 'íŠ¸ë¼ìš°ë§ˆ íšŒë³µ', description: 'ê³¼ê±°ì˜ ì–´ë ¤ìš´ ê²½í—˜ì€ ì „ë¬¸ê°€ì˜ ë„ì›€ì„ ë°›ì•„ ì¹˜ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' });
            }

            return connections.slice(0, 4);
        }

        // ì¶”ì²œ ì½˜í…ì¸  ìƒì„±
        function getRecommendations(emotion, content) {
            const recommendations = [];
            const text = content.toLowerCase();

            // ê°ì • ê¸°ë°˜ ì¶”ì²œ
            const emotionRecommendations = {
                'ë¶ˆì•ˆ': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ë§ˆìŒì±™ê¹€ ëª…ìƒìœ¼ë¡œ ë¶ˆì•ˆ ë‹¤ìŠ¤ë¦¬ê¸°', url: 'https://www.youtube.com/results?search_query=ë§ˆìŒì±™ê¹€+ëª…ìƒ+ë¶ˆì•ˆ' },
                    { type: 'ì˜ìƒ', title: 'ë¶ˆì•ˆì¥ì•  ì´í•´í•˜ê¸°', url: 'https://www.youtube.com/results?search_query=ë¶ˆì•ˆì¥ì• +ì´í•´' }
                ],
                'ìŠ¬í””': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ìš°ìš¸ê°ê³¼ ìŠ¬í”” ë‹¤ë£¨ê¸°', url: 'https://www.youtube.com/results?search_query=ìš°ìš¸ê°+ìŠ¬í””+ëŒ€ì²˜' },
                    { type: 'ì˜ìƒ', title: 'ê°ì • ì¡°ì ˆ ê¸°ë²•', url: 'https://www.youtube.com/results?search_query=ê°ì •+ì¡°ì ˆ+ê¸°ë²•' }
                ],
                'í™”ë‚¨': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ë¶„ë…¸ ê´€ë¦¬ ë°©ë²•', url: 'https://www.youtube.com/results?search_query=ë¶„ë…¸+ê´€ë¦¬' },
                    { type: 'ì˜ìƒ', title: 'ê±´ê°•í•œ ê°ì • í‘œí˜„', url: 'https://www.youtube.com/results?search_query=ê±´ê°•í•œ+ê°ì •+í‘œí˜„' }
                ],
                'ê¸°ì¨': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ê¸ì • ì‹¬ë¦¬í•™', url: 'https://www.youtube.com/results?search_query=ê¸ì •+ì‹¬ë¦¬í•™' },
                    { type: 'ì˜ìƒ', title: 'í–‰ë³µ ì¦ì§„ ë°©ë²•', url: 'https://www.youtube.com/results?search_query=í–‰ë³µ+ì¦ì§„' }
                ]
            };

            if (emotionRecommendations[emotion]) {
                recommendations.push(...emotionRecommendations[emotion]);
            }

            // ë‚´ìš© ê¸°ë°˜ ì¶”ì²œ
            if (text.includes('ìŠ¤íŠ¸ë ˆìŠ¤')) {
                recommendations.push({ type: 'íŒŸìºìŠ¤íŠ¸', title: 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ íŒŸìºìŠ¤íŠ¸', url: 'https://www.youtube.com/results?search_query=ìŠ¤íŠ¸ë ˆìŠ¤+ê´€ë¦¬+íŒŸìºìŠ¤íŠ¸' });
            }
            if (text.includes('ê´€ê³„') || text.includes('ì‚¬ëŒ')) {
                recommendations.push({ type: 'ì˜ìƒ', title: 'ê±´ê°•í•œ ëŒ€ì¸ê´€ê³„', url: 'https://www.youtube.com/results?search_query=ê±´ê°•í•œ+ëŒ€ì¸ê´€ê³„' });
            }
            if (text.includes('ìì¡´ê°')) {
                recommendations.push({ type: 'íŒŸìºìŠ¤íŠ¸', title: 'ìì¡´ê° íšŒë³µí•˜ê¸°', url: 'https://www.youtube.com/results?search_query=ìì¡´ê°+íšŒë³µ' });
            }

            // ê¸°ë³¸ ì¶”ì²œ
            if (recommendations.length === 0) {
                recommendations.push(
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ì‹¬ë¦¬í•™ íŒŸìºìŠ¤íŠ¸ ëª¨ìŒ', url: 'https://www.youtube.com/results?search_query=ì‹¬ë¦¬í•™+íŒŸìºìŠ¤íŠ¸' },
                    { type: 'ì˜ìƒ', title: 'ì‹¬ë¦¬í•™ ê°•ì˜', url: 'https://www.youtube.com/results?search_query=ì‹¬ë¦¬í•™+ê°•ì˜' }
                );
            }

            return recommendations.slice(0, 4);
        }

        // ì¼ê¸° ì§€ìš°ê¸°
        function clearDiary() {
            diaryInput.value = '';
            diaryCharCount.textContent = '0';
            selectedEmotion = null;
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        // ì €ì¥ëœ ì¼ê¸° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadDiaries() {
            const diaries = JSON.parse(localStorage.getItem('gpt_keyboard_diaries') || '[]');
            const diaryList = document.getElementById('diaryList');
            const diaryEntries = document.getElementById('diaryEntries');

            if (diaries.length === 0) {
                diaryList.style.display = 'none';
                return;
            }

            diaryList.style.display = 'block';
            diaryEntries.innerHTML = diaries.map(diary => 
                `<div class="diary-entry">
                    <div class="date">${diary.date}</div>
                    <span class="emotion-tag">${diary.emotion}</span>
                    <div style="margin-top: 10px;">${diary.content}</div>
                </div>`
            ).join('');
        }
    </script>
</body>
</html>

