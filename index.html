<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT Keyboard - ì‹¬ë¦¬í•™ íŠ¹í™” AI í‚¤ë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }


        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1em;
        }

        input[type="text"],
        input[type="password"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .keyboard-area {
            margin-top: 30px;
        }

        .keyboard-area h3 {
            color: #333;
            margin-bottom: 15px;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .suggestions {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .suggestions h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .suggestion-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }

        .suggestion-item:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            line-height: 1.5;
        }

        .info-text a {
            color: #667eea;
            text-decoration: none;
        }

        .info-text a:hover {
            text-decoration: underline;
        }

        .char-count {
            text-align: right;
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            color: #667eea;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .emotion-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .emotion-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .emotion-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .emotion-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .psychology-connection {
            margin-top: 20px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .psychology-connection h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .connection-item {
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .connection-item strong {
            color: #667eea;
        }

        .recommendations {
            margin-top: 20px;
            padding: 20px;
            background: #fff5f5;
            border-radius: 12px;
            border-left: 4px solid #ff6b9d;
        }

        .recommendations h4 {
            color: #ff6b9d;
            margin-bottom: 15px;
        }

        .recommendation-item {
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recommendation-item:hover {
            background: #ff6b9d;
            color: white;
            transform: translateX(5px);
        }

        .diary-list {
            margin-top: 20px;
        }

        .diary-entry {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .diary-entry .date {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .diary-entry .emotion-tag {
            display: inline-block;
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h4 {
            margin-bottom: 10px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .emotion-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .emotion-bar-label {
            width: 80px;
            font-weight: 600;
            color: #333;
        }

        .emotion-bar-fill {
            flex: 1;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
            min-width: 50px;
        }

        .dictionary-item {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dictionary-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .dictionary-item h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .dictionary-item p {
            color: #666;
            line-height: 1.6;
        }

        .mindfulness-exercise {
            padding: 20px;
            margin: 15px 0;
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%);
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .mindfulness-exercise h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .breathing-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            transition: transform 0.5s ease;
        }

        .breathing-circle.breathing-in {
            transform: scale(1.2);
        }

        .breathing-circle.breathing-out {
            transform: scale(0.9);
        }

        .tip-card {
            padding: 20px;
            margin: 15px 0;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border-radius: 12px;
            border-left: 4px solid #ff6b9d;
        }

        .tip-card h4 {
            color: #ff6b9d;
            margin-bottom: 10px;
        }

        .tip-card p {
            color: #666;
            line-height: 1.8;
        }

        .coping-guide {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .coping-guide h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .coping-guide ul {
            margin-left: 20px;
            color: #666;
            line-height: 1.8;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .calendar-day {
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 0.9em;
        }

        .calendar-day.has-entry {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âŒ¨ï¸ GPT Keyboard</h1>
            <p>ì‹¬ë¦¬í•™ íŠ¹í™” AI í‚¤ë³´ë“œ - ì‹¬ë¦¬í•™ ì „ë¬¸ê°€ë¥¼ ìœ„í•œ ìŠ¤ë§ˆíŠ¸ í…ìŠ¤íŠ¸ ì…ë ¥</p>
        </div>

        <div class="main-card">
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('keyboard')">âŒ¨ï¸ ì‹¬ë¦¬í•™ í‚¤ë³´ë“œ</button>
                <button class="tab-btn" onclick="showTab('diary')">ğŸ“” ê°ì • ì¼ê¸°</button>
                <button class="tab-btn" onclick="showTab('stats')">ğŸ“Š ê°ì • í†µê³„</button>
                <button class="tab-btn" onclick="showTab('test')">ğŸ§ª ì‹¬ë¦¬ í…ŒìŠ¤íŠ¸</button>
                <button class="tab-btn" onclick="showTab('analysis')">ğŸ” ìê¸° ëŒ€í™” ë¶„ì„</button>
                <button class="tab-btn" onclick="showTab('pattern')">ğŸ“ˆ ê°ì • íŒ¨í„´</button>
                <button class="tab-btn" onclick="showTab('goals')">ğŸ¯ ëª©í‘œ ì„¤ì •</button>
                <button class="tab-btn" onclick="showTab('stress')">ğŸ˜° ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬</button>
                <button class="tab-btn" onclick="showTab('dictionary')">ğŸ“š ì‹¬ë¦¬í•™ ì‚¬ì „</button>
                <button class="tab-btn" onclick="showTab('mindfulness')">ğŸ§˜ ë§ˆìŒì±™ê¹€</button>
                <button class="tab-btn" onclick="showTab('tips')">ğŸ’¡ ì‹¬ë¦¬í•™ íŒ</button>
            </div>

            <!-- ì‹¬ë¦¬í•™ í‚¤ë³´ë“œ íƒ­ -->
            <div id="keyboard" class="tab-content active">
                <div class="keyboard-area">
                    <h3>âœï¸ í…ìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <textarea id="textInput" placeholder="ì‹¬ë¦¬í•™ ê´€ë ¨ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...&#10;&#10;ì˜ˆ: ì¸ì§€ í–‰ë™ ì¹˜ë£Œ, ê³µê°ì  ëŒ€ì‘, ê°ì • ì¡°ì ˆ ë“±&#10;ì…ë ¥í•˜ë©´ AIê°€ ì‹¬ë¦¬í•™ ì „ë¬¸ê°€ ê´€ì ì—ì„œ ì œì•ˆì„ ì œê³µí•©ë‹ˆë‹¤."></textarea>
                        <div class="char-count">
                            <span id="charCount">0</span> ê¸€ì
                        </div>
                    </div>

                    <div class="suggestions" id="suggestions" style="display: none;">
                        <h4>ğŸ’¡ AI ì œì•ˆ</h4>
                        <div id="suggestionList"></div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="getAISuggestion()">ğŸ¤– AI ì œì•ˆ ë°›ê¸°</button>
                        <button class="btn btn-secondary" onclick="clearText()">ì§€ìš°ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ê°ì • ì¼ê¸° íƒ­ -->
            <div id="diary" class="tab-content">
                <h3>ğŸ“” ì˜¤ëŠ˜ì˜ ê°ì • ì¼ê¸°</h3>
                
                <div class="form-group">
                    <label>ì˜¤ëŠ˜ì˜ ê°ì •ì„ ì„ íƒí•˜ì„¸ìš”</label>
                    <div class="emotion-selector" id="emotionSelector">
                        <div class="emotion-btn" onclick="selectEmotion('ê¸°ì¨')">ğŸ˜Š ê¸°ì¨</div>
                        <div class="emotion-btn" onclick="selectEmotion('ìŠ¬í””')">ğŸ˜¢ ìŠ¬í””</div>
                        <div class="emotion-btn" onclick="selectEmotion('í™”ë‚¨')">ğŸ˜  í™”ë‚¨</div>
                        <div class="emotion-btn" onclick="selectEmotion('ë¶ˆì•ˆ')">ğŸ˜° ë¶ˆì•ˆ</div>
                        <div class="emotion-btn" onclick="selectEmotion('í‰ì˜¨')">ğŸ˜Œ í‰ì˜¨</div>
                        <div class="emotion-btn" onclick="selectEmotion('í”¼ê³¤')">ğŸ˜´ í”¼ê³¤</div>
                        <div class="emotion-btn" onclick="selectEmotion('í¥ë¯¸')">ğŸ¤” í¥ë¯¸</div>
                        <div class="emotion-btn" onclick="selectEmotion('ì‚¬ë‘')">â¤ï¸ ì‚¬ë‘</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="diaryInput">ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”? ê¸°ë¶„ì´ë‚˜ ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”.</label>
                    <textarea id="diaryInput" placeholder="ì˜¤ëŠ˜ì˜ ê°ì •ê³¼ ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”...&#10;&#10;ì˜ˆ: ì˜¤ëŠ˜ íšŒì˜ì—ì„œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§ì´ ë°›ì•˜ì–´ìš”. ê³„ì† ë¶ˆì•ˆí•œ ê¸°ë¶„ì´ ë“¤ê³ ..."></textarea>
                    <div class="char-count">
                        <span id="diaryCharCount">0</span> ê¸€ì
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="saveDiary()">ğŸ’¾ ì¼ê¸° ì €ì¥</button>
                    <button class="btn btn-primary" onclick="analyzeEmotion()">ğŸ” ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„</button>
                    <button class="btn btn-secondary" onclick="clearDiary()">ì§€ìš°ê¸°</button>
                </div>

                <div class="psychology-connection" id="psychologyConnection" style="display: none;">
                    <h4>ğŸ§  ì‹¬ë¦¬í•™ì  ì—°ê²°</h4>
                    <div id="connectionList"></div>
                </div>

                <div class="recommendations" id="recommendations" style="display: none;">
                    <h4>ğŸ“š ì¶”ì²œ ì½˜í…ì¸ </h4>
                    <div id="recommendationList"></div>
                </div>

                <div class="diary-list" id="diaryList" style="display: none;">
                    <h3 style="margin-top: 30px; margin-bottom: 15px;">ğŸ“– ì €ì¥ëœ ì¼ê¸°</h3>
                    <div class="search-box">
                        <input type="text" id="diarySearch" placeholder="ì¼ê¸° ê²€ìƒ‰..." onkeyup="searchDiaries()">
                    </div>
                    <div id="diaryEntries"></div>
                </div>
            </div>

            <!-- ê°ì • í†µê³„ íƒ­ -->
            <div id="stats" class="tab-content">
                <h3>ğŸ“Š ê°ì • í†µê³„</h3>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <h4>ì´ ì¼ê¸° ìˆ˜</h4>
                        <div class="value" id="totalDiaries">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>ê°€ì¥ ë§ì€ ê°ì •</h4>
                        <div class="value" id="mostEmotion">-</div>
                    </div>
                    <div class="stat-card">
                        <h4>ì´ë²ˆ ì£¼ ì¼ê¸°</h4>
                        <div class="value" id="weekDiaries">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>ì´ë²ˆ ë‹¬ ì¼ê¸°</h4>
                        <div class="value" id="monthDiaries">0</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h4 style="margin-bottom: 15px;">ê°ì •ë³„ ë¶„í¬</h4>
                    <div id="emotionChart"></div>
                </div>

                <div class="chart-container">
                    <h4 style="margin-bottom: 15px;">ìµœê·¼ 30ì¼ ê°ì • ì¶”ì´</h4>
                    <div id="emotionTrend"></div>
                </div>
            </div>

            <!-- ì‹¬ë¦¬í•™ ì‚¬ì „ íƒ­ -->
            <div id="dictionary" class="tab-content">
                <h3>ğŸ“š ì‹¬ë¦¬í•™ ìš©ì–´ ì‚¬ì „</h3>
                <div class="search-box">
                    <input type="text" id="dictSearch" placeholder="ì‹¬ë¦¬í•™ ìš©ì–´ ê²€ìƒ‰..." onkeyup="searchDictionary()">
                </div>
                <div id="dictionaryList"></div>
            </div>

            <!-- ë§ˆìŒì±™ê¹€ íƒ­ -->
            <div id="mindfulness" class="tab-content">
                <h3>ğŸ§˜ ë§ˆìŒì±™ê¹€ ê°€ì´ë“œ</h3>
                
                <div class="mindfulness-exercise">
                    <h4>ğŸŒ¬ï¸ í˜¸í¡ ìš´ë™</h4>
                    <p style="margin-bottom: 15px; color: #666;">ì²œì²œíˆ í˜¸í¡í•˜ë©° ë§ˆìŒì„ ì§„ì •ì‹œí‚¤ì„¸ìš”. ì•„ë˜ ì›ì„ ë”°ë¼ í˜¸í¡í•˜ì„¸ìš”.</p>
                    <div class="breathing-circle" id="breathingCircle">
                        <div id="breathingText">ì‹œì‘í•˜ê¸°</div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="startBreathing()" id="breathingBtn">í˜¸í¡ ì‹œì‘</button>
                        <button class="btn btn-secondary" onclick="stopBreathing()" id="stopBreathingBtn" style="display: none;">ë©ˆì¶”ê¸°</button>
                    </div>
                </div>

                <div class="mindfulness-exercise">
                    <h4>ğŸ’­ ë§ˆìŒì±™ê¹€ ëª…ìƒ ê°€ì´ë“œ</h4>
                    <p style="color: #666; line-height: 1.8; margin-bottom: 15px;">
                        <strong>5ë¶„ ë§ˆìŒì±™ê¹€ ëª…ìƒ:</strong><br>
                        1. í¸ì•ˆí•œ ìì„¸ë¡œ ì•‰ê±°ë‚˜ ëˆ„ìš°ì„¸ìš”<br>
                        2. ëˆˆì„ ê°ê³  ìì—°ìŠ¤ëŸ½ê²Œ í˜¸í¡í•˜ì„¸ìš”<br>
                        3. í˜¸í¡ì— ì§‘ì¤‘í•˜ë©° ìƒê°ì´ ë– ì˜¤ë¥´ë©´ ë‹¤ì‹œ í˜¸í¡ìœ¼ë¡œ ëŒì•„ì˜¤ì„¸ìš”<br>
                        4. ëª¸ì˜ ê°ê°ì„ ëŠê»´ë³´ì„¸ìš”<br>
                        5. ë§ˆì§€ë§‰ìœ¼ë¡œ ê°ì‚¬í•œ ì¼ì„ ë– ì˜¬ë ¤ë³´ì„¸ìš”
                    </p>
                </div>

                <div class="mindfulness-exercise">
                    <h4>ğŸŒ™ ìˆ˜ë©´ ê°€ì´ë“œ</h4>
                    <p style="color: #666; line-height: 1.8;">
                        <strong>ì ë“¤ê¸° ì „ ë§ˆìŒì±™ê¹€:</strong><br>
                        â€¢ ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ë˜ëŒì•„ë³´ë©° ê°ì‚¬í•œ ì¼ì„ ë– ì˜¬ë ¤ë³´ì„¸ìš”<br>
                        â€¢ ê¸´ì¥ëœ ê·¼ìœ¡ì„ í•˜ë‚˜ì”© ì´ì™„ì‹œì¼œë³´ì„¸ìš”<br>
                        â€¢ í¸ì•ˆí•œ í˜¸í¡ì— ì§‘ì¤‘í•˜ë©° ì ì— ë¹ ì ¸ë“œì„¸ìš”
                    </p>
                </div>
            </div>

            <!-- ì‹¬ë¦¬ í…ŒìŠ¤íŠ¸ íƒ­ -->
            <div id="test" class="tab-content">
                <h3>ğŸ§ª ì‹¬ë¦¬ í…ŒìŠ¤íŠ¸</h3>
                <p style="color: #666; margin-bottom: 20px;">ê°„ë‹¨í•œ ìê¸° ì§„ë‹¨ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ìì‹ ì˜ ì‹¬ë¦¬ ìƒíƒœë¥¼ ì•Œì•„ë³´ì„¸ìš”.</p>
                
                <div class="test-card" style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h4>ğŸ“Š ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ í…ŒìŠ¤íŠ¸</h4>
                    <p style="color: #666; margin: 10px 0;">ìµœê·¼ 2ì£¼ ë™ì•ˆì˜ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.</p>
                    <div id="stressTestQuestions"></div>
                    <button class="btn btn-primary" onclick="startStressTest()" id="startStressTestBtn">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
                    <div id="stressTestResult" style="display: none; margin-top: 20px; padding: 20px; background: white; border-radius: 8px;"></div>
                </div>

                <div class="test-card" style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h4>ğŸ˜Š ê¸ì •ì„± í…ŒìŠ¤íŠ¸</h4>
                    <p style="color: #666; margin: 10px 0;">ì¼ìƒìƒí™œì—ì„œ ê¸ì •ì ì¸ ì‚¬ê³ ë¥¼ ì–¼ë§ˆë‚˜ í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                    <div id="positivityTestQuestions"></div>
                    <button class="btn btn-primary" onclick="startPositivityTest()" id="startPositivityTestBtn">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
                    <div id="positivityTestResult" style="display: none; margin-top: 20px; padding: 20px; background: white; border-radius: 8px;"></div>
                </div>

                <div class="test-card" style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h4>ğŸ’ª ìì¡´ê° í…ŒìŠ¤íŠ¸</h4>
                    <p style="color: #666; margin: 10px 0;">ìì‹ ì— ëŒ€í•œ í‰ê°€ì™€ ì¸ì‹ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                    <div id="selfEsteemTestQuestions"></div>
                    <button class="btn btn-primary" onclick="startSelfEsteemTest()" id="startSelfEsteemTestBtn">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
                    <div id="selfEsteemTestResult" style="display: none; margin-top: 20px; padding: 20px; background: white; border-radius: 8px;"></div>
                </div>
            </div>

            <!-- ìê¸° ëŒ€í™” ë¶„ì„ íƒ­ -->
            <div id="analysis" class="tab-content">
                <h3>ğŸ” ìê¸° ëŒ€í™” ë¶„ì„</h3>
                <p style="color: #666; margin-bottom: 20px;">ì‘ì„±í•œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ìê¸° ëŒ€í™” íŒ¨í„´ì„ íŒŒì•…í•˜ê³  ê°œì„ ì ì„ ì°¾ì•„ë³´ì„¸ìš”.</p>
                
                <div class="form-group">
                    <label>ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</label>
                    <textarea id="selfTalkInput" placeholder="ì˜ˆ: ë‚˜ëŠ” í•­ìƒ ì‹¤ìˆ˜ë§Œ í•´. ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ ë‹¤ ì˜í•˜ëŠ”ë° ë‚˜ë§Œ ëª»í•´. ë‚˜ëŠ” ê°€ì¹˜ ì—†ëŠ” ì‚¬ëŒì´ì•¼..." style="min-height: 150px;"></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="analyzeSelfTalk()">ğŸ” ìê¸° ëŒ€í™” ë¶„ì„í•˜ê¸°</button>
                
                <div id="selfTalkAnalysis" style="display: none; margin-top: 30px;">
                    <div class="analysis-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px; margin-bottom: 20px;">
                        <h4>ğŸ“Š ë¶„ì„ ê²°ê³¼</h4>
                        <div id="selfTalkResult"></div>
                    </div>
                    
                    <div class="analysis-card" style="padding: 20px; background: #fff3cd; border-radius: 12px; margin-bottom: 20px;">
                        <h4>ğŸ’¡ ê°œì„  ì œì•ˆ</h4>
                        <div id="selfTalkSuggestions"></div>
                    </div>
                    
                    <div class="analysis-card" style="padding: 20px; background: #d1ecf1; border-radius: 12px;">
                        <h4>âœ¨ ê¸ì •ì  ëŒ€ì•ˆ</h4>
                        <div id="selfTalkAlternatives"></div>
                    </div>
                </div>
            </div>

            <!-- ê°ì • íŒ¨í„´ íƒ­ -->
            <div id="pattern" class="tab-content">
                <h3>ğŸ“ˆ ê°ì • íŒ¨í„´ ë¶„ì„</h3>
                <p style="color: #666; margin-bottom: 20px;">ê°ì • ì¼ê¸° ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ê°ì • íŒ¨í„´ê³¼ ì¸ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                
                <div id="patternInsights" style="margin-bottom: 30px;"></div>
                
                <div class="pattern-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px; margin-bottom: 20px;">
                    <h4>ğŸ“… ìš”ì¼ë³„ ê°ì • íŒ¨í„´</h4>
                    <div id="weeklyPattern"></div>
                </div>
                
                <div class="pattern-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px; margin-bottom: 20px;">
                    <h4>ğŸ”„ ê°ì • ë³€í™” ì¶”ì´</h4>
                    <div id="emotionTrendChart"></div>
                </div>
                
                <div class="pattern-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h4>ğŸ’­ ê°ì • íŠ¸ë¦¬ê±° ë¶„ì„</h4>
                    <div id="emotionTriggers"></div>
                </div>
            </div>

            <!-- ëª©í‘œ ì„¤ì • íƒ­ -->
            <div id="goals" class="tab-content">
                <h3>ğŸ¯ ì‹¬ë¦¬í•™ ê¸°ë°˜ ëª©í‘œ ì„¤ì •</h3>
                <p style="color: #666; margin-bottom: 20px;">SMART ì›ì¹™ì„ í™œìš©í•˜ì—¬ íš¨ê³¼ì ì¸ ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ì¶”ì í•˜ì„¸ìš”.</p>
                
                <div class="form-group">
                    <label>ëª©í‘œ ì œëª©</label>
                    <input type="text" id="goalTitle" placeholder="ì˜ˆ: ë§¤ì¼ 10ë¶„ ëª…ìƒí•˜ê¸°">
                </div>
                
                <div class="form-group">
                    <label>ëª©í‘œ ì„¤ëª…</label>
                    <textarea id="goalDescription" placeholder="êµ¬ì²´ì ì¸ ëª©í‘œì™€ ì´ìœ ë¥¼ ì„¤ëª…í•˜ì„¸ìš”..." style="min-height: 100px;"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ëª©í‘œ ìœ í˜•</label>
                    <select id="goalType" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="mental">ì •ì‹  ê±´ê°•</option>
                        <option value="emotional">ê°ì • ê´€ë¦¬</option>
                        <option value="social">ì‚¬íšŒì„±</option>
                        <option value="selfcare">ìê¸° ëŒë´„</option>
                        <option value="growth">ì„±ì¥</option>
                        <option value="other">ê¸°íƒ€</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ëª©í‘œ ê¸°ê°„</label>
                    <input type="date" id="goalDeadline" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>
                
                <button class="btn btn-primary" onclick="addGoal()">ëª©í‘œ ì¶”ê°€</button>
                
                <div id="goalsList" style="margin-top: 30px;"></div>
            </div>

            <!-- ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ íƒ­ -->
            <div id="stress" class="tab-content">
                <h3>ğŸ˜° ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬</h3>
                <p style="color: #666; margin-bottom: 20px;">í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì„ ì¸¡ì •í•˜ê³  ê´€ë¦¬ ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                
                <div class="stress-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px; margin-bottom: 20px;">
                    <h4>ğŸ“Š í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨</h4>
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px;">ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ (1-10)</label>
                        <input type="range" id="stressLevel" min="1" max="10" value="5" style="width: 100%;" oninput="updateStressLevel(this.value)">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.9em; color: #666;">ë‚®ìŒ (1)</span>
                            <span id="stressValue" style="font-size: 1.2em; font-weight: 600; color: #667eea;">5</span>
                            <span style="font-size: 0.9em; color: #666;">ë†’ìŒ (10)</span>
                        </div>
                    </div>
                    <div id="stressDescription" style="padding: 15px; background: white; border-radius: 8px; margin-top: 15px;"></div>
                </div>
                
                <div class="stress-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px; margin-bottom: 20px;">
                    <h4>ğŸ“ ìŠ¤íŠ¸ë ˆìŠ¤ ì›ì¸ ê¸°ë¡</h4>
                    <div class="form-group">
                        <textarea id="stressCause" placeholder="ì˜¤ëŠ˜ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì€ ì›ì¸ì„ ê¸°ë¡í•˜ì„¸ìš”..." style="min-height: 100px;"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveStressRecord()">ê¸°ë¡ ì €ì¥</button>
                </div>
                
                <div class="stress-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px; margin-bottom: 20px;">
                    <h4>ğŸ’¡ ë§ì¶¤í˜• ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë°©ë²•</h4>
                    <div id="stressManagementTips"></div>
                </div>
                
                <div class="stress-card" style="padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h4>ğŸ“ˆ ìŠ¤íŠ¸ë ˆìŠ¤ ì¶”ì´</h4>
                    <div id="stressHistory"></div>
                </div>
            </div>

            <!-- ì‹¬ë¦¬í•™ íŒ íƒ­ -->
            <div id="tips" class="tab-content">
                <h3>ğŸ’¡ ì‹¬ë¦¬í•™ íŒ & ê°€ì´ë“œ</h3>
                
                <div class="tip-card">
                    <h4>ğŸ˜Š ê¸°ì¨ì„ ëŠë‚„ ë•Œ</h4>
                    <p>
                        ê¸°ì¨ì„ ëŠë‚„ ë•ŒëŠ” ê·¸ ìˆœê°„ì„ ì¶©ë¶„íˆ ì¦ê¸°ê³ , ê°ì‚¬ ì¼ê¸°ì— ê¸°ë¡í•´ë³´ì„¸ìš”. 
                        ê¸ì •ì ì¸ ê²½í—˜ì„ ë˜ìƒˆê¸°ëŠ” ê²ƒì€ í–‰ë³µì„ ì¦ì§„ì‹œí‚µë‹ˆë‹¤. 
                        ì£¼ë³€ ì‚¬ëŒë“¤ê³¼ ê¸°ì¨ì„ ë‚˜ëˆ„ë©´ ë” ì˜¤ë˜ ì§€ì†ë  ìˆ˜ ìˆì–´ìš”.
                    </p>
                </div>

                <div class="tip-card">
                    <h4>ğŸ˜¢ ìŠ¬í””ì„ ëŠë‚„ ë•Œ</h4>
                    <p>
                        ìŠ¬í””ì€ ìì—°ìŠ¤ëŸ¬ìš´ ê°ì •ì…ë‹ˆë‹¤. ê°ì •ì„ ì–µëˆ„ë¥´ì§€ ë§ê³  ì¸ì •í•˜ì„¸ìš”. 
                        ì¶©ë¶„íˆ ìŠ¬í¼í•  ì‹œê°„ì„ ì£¼ê³ , ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒê³¼ ëŒ€í™”í•´ë³´ì„¸ìš”. 
                        ê·œì¹™ì ì¸ ìƒí™œ íŒ¨í„´ì„ ìœ ì§€í•˜ëŠ” ê²ƒë„ ë„ì›€ì´ ë©ë‹ˆë‹¤.
                    </p>
                </div>

                <div class="tip-card">
                    <h4>ğŸ˜  í™”ê°€ ë‚  ë•Œ</h4>
                    <p>
                        í™”ê°€ ë‚˜ë©´ ë¨¼ì € ê¹Šê²Œ ìˆ¨ì„ ì‰¬ì–´ë³´ì„¸ìš”. 10ì´ˆ ì •ë„ ë©ˆì¶°ì„œ ìƒê°í•´ë³´ê³ , 
                        ê°ì •ì˜ ì›ì¸ì„ íŒŒì•…í•´ë³´ì„¸ìš”. ê±´ê°•í•œ ë°©ë²•ìœ¼ë¡œ ê°ì •ì„ í‘œí˜„í•˜ê±°ë‚˜, 
                        ìš´ë™ì´ë‚˜ ì°½ì˜ì  í™œë™ìœ¼ë¡œ ì—ë„ˆì§€ë¥¼ ë°œì‚°í•´ë³´ì„¸ìš”.
                    </p>
                </div>

                <div class="tip-card">
                    <h4>ğŸ˜° ë¶ˆì•ˆí•  ë•Œ</h4>
                    <p>
                        ë¶ˆì•ˆí•  ë•ŒëŠ” í˜„ì¬ ìˆœê°„ì— ì§‘ì¤‘í•˜ì„¸ìš”. 5-4-3-2-1 ê¸°ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”: 
                        ë³´ì´ëŠ” ê²ƒ 5ê°œ, ë“¤ë¦¬ëŠ” ê²ƒ 4ê°œ, ë§Œì§ˆ ìˆ˜ ìˆëŠ” ê²ƒ 3ê°œ, ëƒ„ìƒˆë‚˜ëŠ” ê²ƒ 2ê°œ, 
                        ë§›ë³¼ ìˆ˜ ìˆëŠ” ê²ƒ 1ê°œë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ë§ˆìŒì±™ê¹€ í˜¸í¡ë„ ë„ì›€ì´ ë©ë‹ˆë‹¤.
                    </p>
                </div>

                <div class="tip-card">
                    <h4>ğŸ˜´ í”¼ê³¤í•  ë•Œ</h4>
                    <p>
                        í”¼ê³¤í•  ë•ŒëŠ” ì¶©ë¶„í•œ íœ´ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤. ê·œì¹™ì ì¸ ìˆ˜ë©´ íŒ¨í„´ì„ ìœ ì§€í•˜ê³ , 
                        ë‚®ì ì€ 20-30ë¶„ìœ¼ë¡œ ì œí•œí•˜ì„¸ìš”. ìŠ¤íŠ¸ë ˆì¹­ì´ë‚˜ ê°€ë²¼ìš´ ì‚°ì±…ìœ¼ë¡œ 
                        ëª¸ì˜ ê¸´ì¥ì„ í’€ì–´ë³´ì„¸ìš”. ìˆ˜ë©´ ìœ„ìƒì„ ê°œì„ í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•©ë‹ˆë‹¤.
                    </p>
                </div>

                <div class="coping-guide">
                    <h4>ğŸ§  ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì²˜ ë°©ë²•</h4>
                    <ul>
                        <li>ê·œì¹™ì ì¸ ìš´ë™ (ì£¼ 3íšŒ ì´ìƒ)</li>
                        <li>ì¶©ë¶„í•œ ìˆ˜ë©´ (7-9ì‹œê°„)</li>
                        <li>ê±´ê°•í•œ ì‹ìŠµê´€ ìœ ì§€</li>
                        <li>ì‚¬íšŒì  ì§€ì§€ ë„¤íŠ¸ì›Œí¬ í™œìš©</li>
                        <li>ì·¨ë¯¸ í™œë™ìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ</li>
                        <li>ì‹œê°„ ê´€ë¦¬ì™€ ìš°ì„ ìˆœìœ„ ì„¤ì •</li>
                        <li>ì „ë¬¸ê°€ ìƒë‹´ ê³ ë ¤</li>
                    </ul>
                </div>

                <div class="coping-guide">
                    <h4>ğŸ’ª ìì¡´ê° í–¥ìƒ ë°©ë²•</h4>
                    <ul>
                        <li>ìê¸° ìì‹ ì—ê²Œ ì¹œì ˆí•˜ê²Œ ëŒ€í•˜ê¸°</li>
                        <li>ê¸ì •ì ì¸ ìê¸° ëŒ€í™” ì‹¤ì²œ</li>
                        <li>ì‘ì€ ëª©í‘œë¥¼ ì„¸ìš°ê³  ë‹¬ì„±í•˜ê¸°</li>
                        <li>ìì‹ ì˜ ê°•ì  ì¸ì‹í•˜ê¸°</li>
                        <li>ë¹„êµí•˜ì§€ ì•Šê³  ìì‹ ì˜ ì†ë„ë¡œ ë‚˜ì•„ê°€ê¸°</li>
                        <li>ì‹¤ìˆ˜ë¥¼ ë°°ì›€ì˜ ê¸°íšŒë¡œ ë³´ê¸°</li>
                        <li>ìê¸° ëŒë´„ ì‹¤ì²œí•˜ê¸°</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('textInput');
        const suggestionsDiv = document.getElementById('suggestions');
        const suggestionList = document.getElementById('suggestionList');
        const charCount = document.getElementById('charCount');
        
        // ê°ì • ì¼ê¸° ê´€ë ¨
        const diaryInput = document.getElementById('diaryInput');
        const diaryCharCount = document.getElementById('diaryCharCount');
        let selectedEmotion = null;

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'diary') {
                loadDiaries();
            } else if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'dictionary') {
                loadDictionary();
            }
        }

        // ê°ì • ì„ íƒ
        function selectEmotion(emotion) {
            selectedEmotion = emotion;
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // ê¸€ì ìˆ˜ ì¹´ìš´íŠ¸
        textInput.addEventListener('input', (e) => {
            charCount.textContent = e.target.value.length;
            // ì…ë ¥ ì¤‘ì¼ ë•Œ ê¸°ë³¸ ì œì•ˆ í‘œì‹œ
            if (e.target.value.length > 0) {
                showBasicSuggestions(e.target.value);
            } else {
                suggestionsDiv.style.display = 'none';
            }
        });

        diaryInput.addEventListener('input', (e) => {
            diaryCharCount.textContent = e.target.value.length;
        });

        // ê¸°ë³¸ ì œì•ˆ (API í‚¤ ì—†ì„ ë•Œ)
        function showBasicSuggestions(text) {
            const suggestions = generateBasicSuggestions(text);
            if (suggestions.length > 0) {
                displaySuggestions(suggestions);
            }
        }

        // ê¸°ë³¸ ì œì•ˆ ìƒì„± (ì‹¬ë¦¬í•™ íŠ¹í™” - ì „ë¬¸ê°€ ìˆ˜ì¤€)
        function generateBasicSuggestions(text) {
            const suggestions = [];
            const words = text.trim().toLowerCase().split(/\s+/);
            const lastWord = words[words.length - 1];
            const textLower = text.toLowerCase();
            const textLength = text.length;
            
            // ì‹¬ë¦¬í•™ ê´€ë ¨ ìš©ì–´ ì™„ì„± (í™•ì¥)
            const psychologyTerms = {
                'ì¸ì§€': ['ì¸ì§€ í–‰ë™ ì¹˜ë£Œ(CBT)', 'ì¸ì§€ ì™œê³¡', 'ì¸ì§€ ì¬êµ¬ì„±', 'ì¸ì§€ ì¹˜ë£Œ ê¸°ë²•', 'ì¸ì§€ íŒ¨í„´'],
                'ê³µê°': ['ê³µê°ì  ëŒ€ì‘', 'ê³µê° ëŠ¥ë ¥', 'ê³µê° í‘œí˜„', 'ê³µê°ì  ê²½ì²­', 'ê³µê° í›ˆë ¨'],
                'ê°ì •': ['ê°ì • ì¡°ì ˆ', 'ê°ì • ì¸ì‹', 'ê°ì • í‘œí˜„', 'ê°ì • ê·œì œ', 'ê°ì • ì²˜ë¦¬'],
                'ìŠ¤íŠ¸ë ˆìŠ¤': ['ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬', 'ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™”', 'ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì²˜', 'ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘', 'ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ'],
                'ë§ˆìŒì±™ê¹€': ['ë§ˆìŒì±™ê¹€ ëª…ìƒ', 'ë§ˆìŒì±™ê¹€ ê¸°ë²•', 'ë§ˆìŒì±™ê¹€ í›ˆë ¨', 'ë§ˆìŒì±™ê¹€ ì‹¤ì²œ', 'ë§ˆìŒì±™ê¹€ í˜¸í¡'],
                'ìì¡´ê°': ['ìì¡´ê° í–¥ìƒ', 'ìì¡´ê° íšŒë³µ', 'ìì¡´ê° í˜•ì„±', 'ìì¡´ê° ë°œë‹¬', 'ê±´ê°•í•œ ìì¡´ê°'],
                'ë¶ˆì•ˆ': ['ë¶ˆì•ˆ ê´€ë¦¬', 'ë¶ˆì•ˆ ì™„í™”', 'ë¶ˆì•ˆ ëŒ€ì²˜', 'ë¶ˆì•ˆì¥ì• ', 'ë¶ˆì•ˆ ì¦ìƒ'],
                'ìš°ìš¸': ['ìš°ìš¸ì¦', 'ìš°ìš¸ê°', 'ìš°ìš¸ ì¦ìƒ', 'ìš°ìš¸ ì¹˜ë£Œ', 'ìš°ìš¸ ê´€ë¦¬'],
                'ìƒë‹´': ['ìƒë‹´ ê³¼ì •', 'ìƒë‹´ ê¸°ë²•', 'ìƒë‹´ ì ‘ê·¼', 'ìƒë‹´ íš¨ê³¼', 'ìƒë‹´ ê´€ê³„'],
                'ì¹˜ë£Œ': ['ì¹˜ë£Œ íš¨ê³¼', 'ì¹˜ë£Œ ê³¼ì •', 'ì¹˜ë£Œ ê¸°ë²•', 'ì¹˜ë£Œ ê³„íš', 'ì¹˜ë£Œ ë™ë§¹'],
                'íŠ¸ë¼ìš°ë§ˆ': ['íŠ¸ë¼ìš°ë§ˆ ì¹˜ë£Œ', 'íŠ¸ë¼ìš°ë§ˆ íšŒë³µ', 'íŠ¸ë¼ìš°ë§ˆ ëŒ€ì²˜', 'íŠ¸ë¼ìš°ë§ˆ ì¹˜ìœ ', 'íŠ¸ë¼ìš°ë§ˆ ì²˜ë¦¬'],
                'ì• ì°©': ['ì• ì°© ì´ë¡ ', 'ì• ì°© ìœ í˜•', 'ì• ì°© ê´€ê³„', 'ì• ì°© íŒ¨í„´', 'ì•ˆì „ ì• ì°©'],
                'ìê¸°íš¨ëŠ¥ê°': ['ìê¸°íš¨ëŠ¥ê° í–¥ìƒ', 'ìê¸°íš¨ëŠ¥ê° ì¦ì§„', 'ìê¸°íš¨ëŠ¥ê° ë°œë‹¬', 'ìê¸°íš¨ëŠ¥ê° í˜•ì„±'],
                'íšŒë³µíƒ„ë ¥ì„±': ['íšŒë³µíƒ„ë ¥ì„± í–¥ìƒ', 'íšŒë³µíƒ„ë ¥ì„± ê¸°ë¥´ê¸°', 'íšŒë³µíƒ„ë ¥ì„± ë°œë‹¬', 'íšŒë³µíƒ„ë ¥ì„± í›ˆë ¨']
            };

            // ë‹¨ì–´ ì™„ì„±
            for (const [key, values] of Object.entries(psychologyTerms)) {
                if (lastWord.startsWith(key) || key.startsWith(lastWord)) {
                    values.forEach(val => {
                        if (!suggestions.includes(val)) {
                            suggestions.push(val);
                        }
                    });
                }
            }

            // ê³ ê¸‰ ë§¥ë½ ë¶„ì„ ê¸°ë°˜ ì œì•ˆ
            analyzeContext(textLower, suggestions);

            // ë¬¸ì¥ ì™„ì„± íŒ¨í„´ (ë” ì •êµí•˜ê²Œ)
            completeSentence(text, suggestions);

            // ì œì•ˆì´ ì—†ìœ¼ë©´ ì§€ëŠ¥í˜• ê¸°ë³¸ ì œì•ˆ
            if (suggestions.length === 0 && textLength > 0) {
                addIntelligentDefaults(text, textLower, suggestions);
            }

            return suggestions.slice(0, 5);
        }

        // ë§¥ë½ ë¶„ì„ í•¨ìˆ˜
        function analyzeContext(textLower, suggestions) {
            // ê°ì • ê´€ë ¨ ë§¥ë½
            if (textLower.includes('ë¶ˆì•ˆ') || textLower.includes('ê±±ì •') || textLower.includes('ë‘ë ¤ì›€')) {
                suggestions.push('ë¶ˆì•ˆ ì™„í™”ë¥¼ ìœ„í•œ ë§ˆìŒì±™ê¹€ ëª…ìƒ', 'í˜¸í¡ ìš´ë™ìœ¼ë¡œ ë¶ˆì•ˆ ê°ì†Œ', 'ì¸ì§€ ì¬êµ¬ì„± ê¸°ë²•');
            }
            if (textLower.includes('ìŠ¤íŠ¸ë ˆìŠ¤') || textLower.includes('ì••ë°•') || textLower.includes('ë¶€ë‹´')) {
                suggestions.push('ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ì „ëµ ìˆ˜ë¦½', 'ì´ì™„ ê¸°ë²• ì‹¤ì²œ', 'ì‹œê°„ ê´€ë¦¬ì™€ ìš°ì„ ìˆœìœ„ ì„¤ì •');
            }
            if (textLower.includes('ê´€ê³„') || textLower.includes('ì‚¬ëŒ') || textLower.includes('ì¹œêµ¬')) {
                suggestions.push('ëŒ€ì¸ê´€ê³„ ê¸°ìˆ  í–¥ìƒ', 'ê±´ê°•í•œ ê²½ê³„ ì„¤ì •', 'íš¨ê³¼ì  ì†Œí†µ ë°©ë²•');
            }
            if (textLower.includes('ìì‹ ') || textLower.includes('ìì¡´ê°') || textLower.includes('ìì‹ ê°')) {
                suggestions.push('ìì¡´ê° í–¥ìƒì„ ìœ„í•œ ìê¸° ìˆ˜ìš©', 'ê¸ì •ì  ìê¸° ëŒ€í™” ì‹¤ì²œ', 'ìê¸° ê°€ì¹˜ ì¸ì‹');
            }
            if (textLower.includes('ê°ì •') && (textLower.includes('ì¡°ì ˆ') || textLower.includes('ê´€ë¦¬'))) {
                suggestions.push('ê°ì • ì¸ì‹ í›ˆë ¨', 'ê°ì • í‘œí˜„ ê¸°ë²•', 'ê°ì • ê·œì œ ì „ëµ ê°œë°œ');
            }
            if (textLower.includes('ì¹˜ë£Œ') || textLower.includes('ìƒë‹´') || textLower.includes('ì‹¬ë¦¬')) {
                suggestions.push('ì¹˜ë£Œ íš¨ê³¼ í‰ê°€ ë°©ë²•', 'ìƒë‹´ ëª©í‘œ ì„¤ì •', 'ì¹˜ë£Œ ë™ë§¹ í˜•ì„±');
            }
            if (textLower.includes('íŠ¸ë¼ìš°ë§ˆ') || textLower.includes('ê³¼ê±°') || textLower.includes('ìƒì²˜')) {
                suggestions.push('íŠ¸ë¼ìš°ë§ˆ ì¹˜ë£Œ ì ‘ê·¼ë²•', 'ì•ˆì „í•œ ê³µê°„ ë§Œë“¤ê¸°', 'íšŒë³µ ê³¼ì • ì´í•´');
            }
            if (textLower.includes('ìš°ìš¸') || textLower.includes('ìŠ¬í””') || textLower.includes('ì ˆë§')) {
                suggestions.push('ìš°ìš¸ê° ê´€ë¦¬ ê¸°ë²•', 'ì¸ì§€ í–‰ë™ ì¹˜ë£Œ ì ‘ê·¼', 'ì‚¬íšŒì  ì§€ì§€ í™œìš©');
            }
            if (textLower.includes('í™”') || textLower.includes('ë¶„ë…¸') || textLower.includes('ì§œì¦')) {
                suggestions.push('ë¶„ë…¸ ê´€ë¦¬ ê¸°ë²•', 'ê°ì • í‘œí˜„ ë°©ë²•', 'ê±´ê°•í•œ ë¶„ë…¸ ì²˜ë¦¬');
            }
            if (textLower.includes('ìˆ˜ë©´') || textLower.includes('ì ') || textLower.includes('ë¶ˆë©´')) {
                suggestions.push('ìˆ˜ë©´ ìœ„ìƒ ê°œì„ ', 'ì´ì™„ ê¸°ë²•ìœ¼ë¡œ ìˆ˜ë©´ ê°œì„ ', 'ë¶ˆë©´ì¦ ê´€ë¦¬');
            }
        }

        // ë¬¸ì¥ ì™„ì„± í•¨ìˆ˜
        function completeSentence(text, suggestions) {
            // ì£¼ì–´ + ì„œìˆ ì–´ íŒ¨í„´
            if (text.endsWith('ì€') || text.endsWith('ëŠ”') || text.endsWith('ì´') || text.endsWith('ê°€')) {
                suggestions.push('ì¤‘ìš”í•œ ì‹¬ë¦¬í•™ì  ê°œë…ì…ë‹ˆë‹¤', 'ì •ì‹  ê±´ê°•ì˜ í•µì‹¬ ìš”ì†Œì…ë‹ˆë‹¤', 'ì¹˜ë£Œ ê³¼ì •ì—ì„œ ì£¼ìš” ìš”ì¸ì…ë‹ˆë‹¤');
            }
            // ì¡°ê±´/ìƒí™© íŒ¨í„´
            if (text.endsWith('ë•Œ') || text.endsWith('ê²½ìš°') || text.endsWith('ìƒí™©')) {
                suggestions.push('ëŒ€ì²˜ ë°©ë²•ì„ ì°¾ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤', 'ì „ë¬¸ê°€ì˜ ë„ì›€ì„ ë°›ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤', 'ìê¸° ëŒë´„ì´ í•„ìš”í•©ë‹ˆë‹¤');
            }
            // ê°€ëŠ¥ì„± íŒ¨í„´
            if (text.endsWith('ìˆ˜') || text.endsWith('í• ') || text.endsWith('ê°€ëŠ¥')) {
                suggestions.push('ìˆìŠµë‹ˆë‹¤', 'ê°€ëŠ¥í•©ë‹ˆë‹¤', 'ë„ì›€ì´ ë©ë‹ˆë‹¤');
            }
            // ì§ˆë¬¸ íŒ¨í„´
            if (text.endsWith('?') || text.endsWith('ê¹Œ') || text.endsWith('ì¸ê°€')) {
                suggestions.push('ì‹¬ë¦¬í•™ì  ê´€ì ì—ì„œ ë¶„ì„í•´ë³´ë©´', 'ì´ëŸ° ê²½ìš° ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤', 'ê°ì • ì¡°ì ˆ ê¸°ë²•ì„ ì‹œë„í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤');
            }
            // ì„¤ëª… íŒ¨í„´
            if (text.endsWith('ë‹¤') || text.endsWith('ìš”') || text.endsWith('ë‹ˆë‹¤')) {
                suggestions.push('ì´ê²ƒì€ ì •ì‹  ê±´ê°•ê³¼ ë°€ì ‘í•œ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤', 'ì‹¬ë¦¬í•™ì  ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤', 'ì¹˜ë£Œ ê³¼ì •ì—ì„œ ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤');
            }
        }

        // ì§€ëŠ¥í˜• ê¸°ë³¸ ì œì•ˆ
        function addIntelligentDefaults(text, textLower, suggestions) {
            // í…ìŠ¤íŠ¸ ê¸¸ì´ì™€ ë‚´ìš© ê¸°ë°˜
            if (textLength < 10) {
                suggestions.push('ë” ìì„¸í•œ ì„¤ëª…ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”', 'êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ ë“¤ì–´ì£¼ì„¸ìš”', 'ì–´ë–¤ ê°ì •ì´ë‚˜ ìƒí™©ì¸ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”');
            } else if (textLength < 30) {
                suggestions.push('ì´ ìƒí™©ì„ ì‹¬ë¦¬í•™ì ìœ¼ë¡œ í•´ì„í•˜ë©´', 'ì´ëŸ° ê²½ìš° ëŒ€ì²˜ ë°©ë²•ì€', 'ê°ì • ì¡°ì ˆ ê¸°ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”');
            } else {
                suggestions.push('ì‹¬ë¦¬í•™ì  ê´€ì ì—ì„œ ë¶„ì„í•´ë³´ë©´', 'ì´ê²ƒì€ ì •ì‹  ê±´ê°•ê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤', 'ì „ë¬¸ê°€ì˜ ë„ì›€ì„ ë°›ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤');
            }

            // í‚¤ì›Œë“œ ê¸°ë°˜ ê¸°ë³¸ ì œì•ˆ
            const keywords = ['ë¬¸ì œ', 'ì–´ë ¤ì›€', 'í˜ë“¤', 'ë„ì›€', 'í•„ìš”'];
            if (keywords.some(kw => textLower.includes(kw))) {
                suggestions.push('ì „ë¬¸ê°€ ìƒë‹´ì„ ê³ ë ¤í•´ë³´ì„¸ìš”', 'ì‹¬ë¦¬í•™ì  ì§€ì›ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'ì¹˜ë£Œ ê³¼ì •ì„ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤');
            }
        }

        // AI ì œì•ˆ ë°›ê¸°
        function getAISuggestion() {
            const text = textInput.value.trim();
            if (!text) {
                alert('í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì œì•ˆ ì˜ì—­ í‘œì‹œ
            suggestionsDiv.style.display = 'block';
            suggestionList.innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">ì œì•ˆì„ ìƒì„±í•˜ëŠ” ì¤‘...</div>';

            // ê¸°ë³¸ ì œì•ˆ ìƒì„±
            const suggestions = generateBasicSuggestions(text);
            
            if (suggestions.length === 0) {
                // ì œì•ˆì´ ì—†ì„ ë•Œë„ ê¸°ë³¸ ì œì•ˆ ì œê³µ
                const defaultSuggestions = getDefaultSuggestions(text);
                displaySuggestions(defaultSuggestions);
            } else {
                displaySuggestions(suggestions);
            }
        }

        // ê¸°ë³¸ ì œì•ˆ (ì œì•ˆì´ ì—†ì„ ë•Œ)
        function getDefaultSuggestions(text) {
            const textLower = text.toLowerCase();
            const suggestions = [];

            // ì¼ë°˜ì ì¸ ì‹¬ë¦¬í•™ ì œì•ˆ
            if (text.length > 0) {
                suggestions.push('ì‹¬ë¦¬í•™ì  ê´€ì ì—ì„œ ë¶„ì„í•´ë³´ë©´', 'ì´ê²ƒì€ ì •ì‹  ê±´ê°•ê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤', 'ì „ë¬¸ê°€ì˜ ë„ì›€ì„ ë°›ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤');
            }

            // í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¥¸ ì œì•ˆ
            if (text.length < 10) {
                suggestions.push('ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”', 'êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ ë“¤ì–´ì£¼ì„¸ìš”', 'ì–´ë–¤ ê°ì •ì„ ëŠë¼ì…¨ë‚˜ìš”?');
            } else {
                suggestions.push('ì´ ìƒí™©ì„ ì‹¬ë¦¬í•™ì ìœ¼ë¡œ í•´ì„í•˜ë©´', 'ì´ëŸ° ê²½ìš° ëŒ€ì²˜ ë°©ë²•ì€', 'ê°ì • ì¡°ì ˆ ê¸°ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”');
            }

            return suggestions.slice(0, 3);
        }

        // ì œì•ˆ í‘œì‹œ
        function displaySuggestions(suggestions) {
            if (suggestions.length === 0) {
                suggestionsDiv.style.display = 'block';
                suggestionList.innerHTML = '<div style="padding: 10px; text-align: center; color: #999;">ì œì•ˆì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.</div>';
                return;
            }

            suggestionsDiv.style.display = 'block';
            suggestionList.innerHTML = suggestions.map(suggestion => 
                `<div class="suggestion-item" onclick="applySuggestion('${suggestion.replace(/'/g, "\\'")}')">${suggestion}</div>`
            ).join('');
        }

        // ì œì•ˆ ì ìš©
        function applySuggestion(suggestion) {
            const currentText = textInput.value;
            textInput.value = currentText + (currentText.endsWith(' ') ? '' : ' ') + suggestion;
            charCount.textContent = textInput.value.length;
            suggestionsDiv.style.display = 'none';
            textInput.focus();
        }

        // í…ìŠ¤íŠ¸ ì§€ìš°ê¸°
        function clearText() {
            textInput.value = '';
            charCount.textContent = '0';
            suggestionsDiv.style.display = 'none';
        }

        // ì´ˆê¸° ê¸€ì ìˆ˜ í‘œì‹œ
        charCount.textContent = textInput.value.length;
        diaryCharCount.textContent = diaryInput.value.length;

        // ê°ì • ì¼ê¸° ì €ì¥
        function saveDiary() {
            const emotion = selectedEmotion;
            const content = diaryInput.value.trim();
            
            if (!emotion) {
                alert('ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!content) {
                alert('ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const diary = {
                id: Date.now(),
                date: new Date().toLocaleDateString('ko-KR'),
                emotion: emotion,
                content: content,
                timestamp: new Date().toISOString()
            };

            const diaries = JSON.parse(localStorage.getItem('gpt_keyboard_diaries') || '[]');
            diaries.unshift(diary);
            localStorage.setItem('gpt_keyboard_diaries', JSON.stringify(diaries));

            alert('ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            clearDiary();
            loadDiaries();
        }

        // ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„
        function analyzeEmotion() {
            const emotion = selectedEmotion;
            const content = diaryInput.value.trim();
            
            if (!emotion || !content) {
                alert('ê°ì •ê³¼ ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const connectionDiv = document.getElementById('psychologyConnection');
            const connectionList = document.getElementById('connectionList');
            const recommendationsDiv = document.getElementById('recommendations');
            const recommendationList = document.getElementById('recommendationList');

            connectionDiv.style.display = 'block';
            connectionList.innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">ë¶„ì„ ì¤‘...</div>';

            // ê°ì •ê³¼ ë‚´ìš© ê¸°ë°˜ ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„
            const connections = analyzePsychologyConnection(emotion, content);
            connectionList.innerHTML = connections.map(conn => 
                `<div class="connection-item">
                    <strong>${conn.term}:</strong> ${conn.description}
                </div>`
            ).join('');

            // ì¶”ì²œ ì½˜í…ì¸  ìƒì„±
            recommendationsDiv.style.display = 'block';
            const recommendations = getRecommendations(emotion, content);
            recommendationList.innerHTML = recommendations.map(rec => 
                `<div class="recommendation-item" onclick="window.open('${rec.url}', '_blank')">
                    <strong>${rec.type}:</strong> ${rec.title}
                </div>`
            ).join('');
        }

        // ì‹¬ë¦¬í•™ ì—°ê²° ë¶„ì„ í•¨ìˆ˜
        function analyzePsychologyConnection(emotion, content) {
            const connections = [];
            const text = content.toLowerCase();

            // ê°ì • ê¸°ë°˜ ì—°ê²°
            const emotionConnections = {
                'ë¶ˆì•ˆ': [
                    { term: 'ë¶ˆì•ˆì¥ì• ', description: 'ì§€ì†ì ì¸ ë¶ˆì•ˆê°ì€ ë¶ˆì•ˆì¥ì• ì™€ ê´€ë ¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§ˆìŒì±™ê¹€ ëª…ìƒì´ë‚˜ ì¸ì§€ í–‰ë™ ì¹˜ë£Œê°€ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”.' },
                    { term: 'ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì²˜', description: 'ë¶ˆì•ˆì€ ìŠ¤íŠ¸ë ˆìŠ¤ì™€ ë°€ì ‘í•œ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ê¹Šì€ í˜¸í¡ì´ë‚˜ ì ì§„ì  ê·¼ìœ¡ ì´ì™„ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”.' }
                ],
                'ìŠ¬í””': [
                    { term: 'ìš°ìš¸ê°', description: 'ì§€ì†ì ì¸ ìŠ¬í””ì€ ìš°ìš¸ê°ê³¼ ì—°ê²°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ì •ì„ ì¸ì •í•˜ê³  í‘œí˜„í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.' },
                    { term: 'ê°ì • ì¡°ì ˆ', description: 'ìŠ¬í””ì„ ê±´ê°•í•˜ê²Œ ë‹¤ë£¨ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê°ì • ì¼ê¸°ë‚˜ ìƒë‹´ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.' }
                ],
                'í™”ë‚¨': [
                    { term: 'ë¶„ë…¸ ê´€ë¦¬', description: 'í™”ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ê°ì •ì´ì§€ë§Œ, ê±´ê°•í•˜ê²Œ í‘œí˜„í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.' },
                    { term: 'ê°ì • ì¸ì‹', description: 'í™”ê°€ ë‚˜ëŠ” ì´ìœ ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ê°ì • ì¡°ì ˆì˜ ì²« ë‹¨ê³„ì…ë‹ˆë‹¤.' }
                ],
                'ê¸°ì¨': [
                    { term: 'ê¸ì • ì‹¬ë¦¬í•™', description: 'ê¸°ì¨ì„ ëŠë¼ëŠ” ìˆœê°„ì„ ê¸°ë¡í•˜ê³  ë˜ìƒˆê¸°ëŠ” ê²ƒì´ í–‰ë³µì„ ì¦ì§„ì‹œí‚¬ ìˆ˜ ìˆì–´ìš”.' },
                    { term: 'ê°ì‚¬ í‘œí˜„', description: 'ê¸°ì¨ì„ ëŠë‚„ ë•Œ ê°ì‚¬ë¥¼ í‘œí˜„í•˜ë©´ ë” ì˜¤ë˜ ì§€ì†ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' }
                ]
            };

            if (emotionConnections[emotion]) {
                connections.push(...emotionConnections[emotion]);
            }

            // ë‚´ìš© ê¸°ë°˜ ì—°ê²°
            if (text.includes('ìŠ¤íŠ¸ë ˆìŠ¤') || text.includes('ì••ë°•')) {
                connections.push({ term: 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬', description: 'ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ì •ì‹  ê±´ê°•ì— í° ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ê·œì¹™ì ì¸ ìš´ë™, ì¶©ë¶„í•œ ìˆ˜ë©´, íœ´ì‹ì´ ì¤‘ìš”í•´ìš”.' });
            }
            if (text.includes('ë¶ˆì•ˆ') || text.includes('ê±±ì •')) {
                connections.push({ term: 'ë¶ˆì•ˆ ê´€ë¦¬ ê¸°ë²•', description: 'ë§ˆìŒì±™ê¹€ ëª…ìƒ, í˜¸í¡ ìš´ë™, ì¸ì§€ ì¬êµ¬ì„±ì´ ë¶ˆì•ˆ ì™„í™”ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.' });
            }
            if (text.includes('ê´€ê³„') || text.includes('ì‚¬ëŒ')) {
                connections.push({ term: 'ëŒ€ì¸ê´€ê³„ ì‹¬ë¦¬í•™', description: 'ê±´ê°•í•œ ê´€ê³„ëŠ” ì •ì‹  ê±´ê°•ì˜ ê¸°ì´ˆì…ë‹ˆë‹¤. ê²½ê³„ ì„¤ì •ê³¼ íš¨ê³¼ì ì¸ ì†Œí†µì´ ì¤‘ìš”í•´ìš”.' });
            }
            if (text.includes('ìì‹ ') || text.includes('ìì¡´ê°')) {
                connections.push({ term: 'ìì¡´ê°', description: 'ìì¡´ê°ì€ ìì‹ ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ë°›ì•„ë“¤ì´ëŠ” ê²ƒì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤. ìê¸° ìì‹ ì—ê²Œ ì¹œì ˆí•˜ê²Œ ëŒ€í•˜ì„¸ìš”.' });
            }
            if (text.includes('ê³¼ê±°') || text.includes('íŠ¸ë¼ìš°ë§ˆ')) {
                connections.push({ term: 'íŠ¸ë¼ìš°ë§ˆ íšŒë³µ', description: 'ê³¼ê±°ì˜ ì–´ë ¤ìš´ ê²½í—˜ì€ ì „ë¬¸ê°€ì˜ ë„ì›€ì„ ë°›ì•„ ì¹˜ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' });
            }

            return connections.slice(0, 4);
        }

        // ì¶”ì²œ ì½˜í…ì¸  ìƒì„±
        function getRecommendations(emotion, content) {
            const recommendations = [];
            const text = content.toLowerCase();

            // ê°ì • ê¸°ë°˜ ì¶”ì²œ
            const emotionRecommendations = {
                'ë¶ˆì•ˆ': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ë§ˆìŒì±™ê¹€ ëª…ìƒìœ¼ë¡œ ë¶ˆì•ˆ ë‹¤ìŠ¤ë¦¬ê¸°', url: 'https://www.youtube.com/results?search_query=ë§ˆìŒì±™ê¹€+ëª…ìƒ+ë¶ˆì•ˆ' },
                    { type: 'ì˜ìƒ', title: 'ë¶ˆì•ˆì¥ì•  ì´í•´í•˜ê¸°', url: 'https://www.youtube.com/results?search_query=ë¶ˆì•ˆì¥ì• +ì´í•´' }
                ],
                'ìŠ¬í””': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ìš°ìš¸ê°ê³¼ ìŠ¬í”” ë‹¤ë£¨ê¸°', url: 'https://www.youtube.com/results?search_query=ìš°ìš¸ê°+ìŠ¬í””+ëŒ€ì²˜' },
                    { type: 'ì˜ìƒ', title: 'ê°ì • ì¡°ì ˆ ê¸°ë²•', url: 'https://www.youtube.com/results?search_query=ê°ì •+ì¡°ì ˆ+ê¸°ë²•' }
                ],
                'í™”ë‚¨': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ë¶„ë…¸ ê´€ë¦¬ ë°©ë²•', url: 'https://www.youtube.com/results?search_query=ë¶„ë…¸+ê´€ë¦¬' },
                    { type: 'ì˜ìƒ', title: 'ê±´ê°•í•œ ê°ì • í‘œí˜„', url: 'https://www.youtube.com/results?search_query=ê±´ê°•í•œ+ê°ì •+í‘œí˜„' }
                ],
                'ê¸°ì¨': [
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ê¸ì • ì‹¬ë¦¬í•™', url: 'https://www.youtube.com/results?search_query=ê¸ì •+ì‹¬ë¦¬í•™' },
                    { type: 'ì˜ìƒ', title: 'í–‰ë³µ ì¦ì§„ ë°©ë²•', url: 'https://www.youtube.com/results?search_query=í–‰ë³µ+ì¦ì§„' }
                ]
            };

            if (emotionRecommendations[emotion]) {
                recommendations.push(...emotionRecommendations[emotion]);
            }

            // ë‚´ìš© ê¸°ë°˜ ì¶”ì²œ
            if (text.includes('ìŠ¤íŠ¸ë ˆìŠ¤')) {
                recommendations.push({ type: 'íŒŸìºìŠ¤íŠ¸', title: 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ íŒŸìºìŠ¤íŠ¸', url: 'https://www.youtube.com/results?search_query=ìŠ¤íŠ¸ë ˆìŠ¤+ê´€ë¦¬+íŒŸìºìŠ¤íŠ¸' });
            }
            if (text.includes('ê´€ê³„') || text.includes('ì‚¬ëŒ')) {
                recommendations.push({ type: 'ì˜ìƒ', title: 'ê±´ê°•í•œ ëŒ€ì¸ê´€ê³„', url: 'https://www.youtube.com/results?search_query=ê±´ê°•í•œ+ëŒ€ì¸ê´€ê³„' });
            }
            if (text.includes('ìì¡´ê°')) {
                recommendations.push({ type: 'íŒŸìºìŠ¤íŠ¸', title: 'ìì¡´ê° íšŒë³µí•˜ê¸°', url: 'https://www.youtube.com/results?search_query=ìì¡´ê°+íšŒë³µ' });
            }

            // ê¸°ë³¸ ì¶”ì²œ
            if (recommendations.length === 0) {
                recommendations.push(
                    { type: 'íŒŸìºìŠ¤íŠ¸', title: 'ì‹¬ë¦¬í•™ íŒŸìºìŠ¤íŠ¸ ëª¨ìŒ', url: 'https://www.youtube.com/results?search_query=ì‹¬ë¦¬í•™+íŒŸìºìŠ¤íŠ¸' },
                    { type: 'ì˜ìƒ', title: 'ì‹¬ë¦¬í•™ ê°•ì˜', url: 'https://www.youtube.com/results?search_query=ì‹¬ë¦¬í•™+ê°•ì˜' }
                );
            }

            return recommendations.slice(0, 4);
        }

        // ì¼ê¸° ì§€ìš°ê¸°
        function clearDiary() {
            diaryInput.value = '';
            diaryCharCount.textContent = '0';
            selectedEmotion = null;
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        // ì €ì¥ëœ ì¼ê¸° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadDiaries(searchTerm = '') {
            const diaries = JSON.parse(localStorage.getItem('gpt_keyboard_diaries') || '[]');
            const diaryList = document.getElementById('diaryList');
            const diaryEntries = document.getElementById('diaryEntries');

            if (diaries.length === 0) {
                diaryList.style.display = 'none';
                return;
            }

            diaryList.style.display = 'block';
            
            let filteredDiaries = diaries;
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredDiaries = diaries.filter(diary => 
                    diary.content.toLowerCase().includes(term) || 
                    diary.emotion.toLowerCase().includes(term) ||
                    diary.date.includes(term)
                );
            }

            if (filteredDiaries.length === 0) {
                diaryEntries.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            diaryEntries.innerHTML = filteredDiaries.map(diary => 
                `<div class="diary-entry">
                    <div class="date">${diary.date}</div>
                    <span class="emotion-tag">${diary.emotion}</span>
                    <div style="margin-top: 10px;">${diary.content}</div>
                </div>`
            ).join('');
        }

        // ì¼ê¸° ê²€ìƒ‰
        function searchDiaries() {
            const searchTerm = document.getElementById('diarySearch').value;
            loadDiaries(searchTerm);
        }

        // ê°ì • í†µê³„ ë¡œë“œ
        function loadStats() {
            const diaries = JSON.parse(localStorage.getItem('gpt_keyboard_diaries') || '[]');
            
            // ì´ ì¼ê¸° ìˆ˜
            document.getElementById('totalDiaries').textContent = diaries.length;

            // ê°ì •ë³„ ì¹´ìš´íŠ¸
            const emotionCount = {};
            diaries.forEach(diary => {
                emotionCount[diary.emotion] = (emotionCount[diary.emotion] || 0) + 1;
            });

            // ê°€ì¥ ë§ì€ ê°ì •
            let mostEmotion = '-';
            let maxCount = 0;
            for (const [emotion, count] of Object.entries(emotionCount)) {
                if (count > maxCount) {
                    maxCount = count;
                    mostEmotion = emotion;
                }
            }
            document.getElementById('mostEmotion').textContent = mostEmotion;

            // ì´ë²ˆ ì£¼ ì¼ê¸°
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekDiaries = diaries.filter(diary => new Date(diary.timestamp) >= weekAgo);
            document.getElementById('weekDiaries').textContent = weekDiaries.length;

            // ì´ë²ˆ ë‹¬ ì¼ê¸°
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            const monthDiaries = diaries.filter(diary => new Date(diary.timestamp) >= monthAgo);
            document.getElementById('monthDiaries').textContent = monthDiaries.length;

            // ê°ì •ë³„ ë¶„í¬ ì°¨íŠ¸
            const chartDiv = document.getElementById('emotionChart');
            const total = diaries.length;
            chartDiv.innerHTML = Object.entries(emotionCount)
                .sort((a, b) => b[1] - a[1])
                .map(([emotion, count]) => {
                    const percent = total > 0 ? Math.round((count / total) * 100) : 0;
                    return `
                        <div class="emotion-bar">
                            <div class="emotion-bar-label">${emotion}</div>
                            <div class="emotion-bar-fill" style="width: ${percent}%;">
                                ${count}ê°œ (${percent}%)
                            </div>
                        </div>
                    `;
                }).join('');

            // ìµœê·¼ 30ì¼ ê°ì • ì¶”ì´
            const trendDiv = document.getElementById('emotionTrend');
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const recentDiaries = diaries.filter(diary => new Date(diary.timestamp) >= thirtyDaysAgo);
            
            const dailyEmotions = {};
            recentDiaries.forEach(diary => {
                const date = diary.date;
                if (!dailyEmotions[date]) {
                    dailyEmotions[date] = [];
                }
                dailyEmotions[date].push(diary.emotion);
            });

            trendDiv.innerHTML = Object.entries(dailyEmotions)
                .slice(-7) // ìµœê·¼ 7ì¼ë§Œ í‘œì‹œ
                .map(([date, emotions]) => {
                    const emotionCounts = {};
                    emotions.forEach(e => emotionCounts[e] = (emotionCounts[e] || 0) + 1);
                    const mainEmotion = Object.entries(emotionCounts).sort((a, b) => b[1] - a[1])[0]?.[0] || '-';
                    return `
                        <div style="padding: 10px; margin: 5px 0; background: white; border-radius: 8px; display: flex; justify-content: space-between;">
                            <span>${date}</span>
                            <span style="font-weight: 600; color: #667eea;">${mainEmotion}</span>
                        </div>
                    `;
                }).join('') || '<div style="padding: 20px; text-align: center; color: #999;">ìµœê·¼ 30ì¼ê°„ ì¼ê¸° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        // ì‹¬ë¦¬í•™ ì‚¬ì „ ë¡œë“œ
        const psychologyDictionary = {
            'ì¸ì§€ í–‰ë™ ì¹˜ë£Œ': {
                term: 'ì¸ì§€ í–‰ë™ ì¹˜ë£Œ (CBT)',
                description: 'ì‚¬ëŒì˜ ìƒê°(ì¸ì§€), ê°ì •, í–‰ë™ì´ ì„œë¡œ ì—°ê²°ë˜ì–´ ìˆë‹¤ëŠ” ì›ë¦¬ì— ê¸°ë°˜í•œ ì¹˜ë£Œë²•. ë¶€ì •ì ì¸ ì‚¬ê³  íŒ¨í„´ì„ ì¸ì‹í•˜ê³  ë³€í™”ì‹œì¼œ ì •ì„œì  ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.'
            },
            'ë§ˆìŒì±™ê¹€': {
                term: 'ë§ˆìŒì±™ê¹€ (Mindfulness)',
                description: 'í˜„ì¬ ìˆœê°„ì— ì˜ë„ì ìœ¼ë¡œ ì£¼ì˜ë¥¼ ê¸°ìš¸ì´ê³ , íŒë‹¨í•˜ì§€ ì•Šê³  ê´€ì°°í•˜ëŠ” ìƒíƒœ. ìŠ¤íŠ¸ë ˆìŠ¤ ê°ì†Œì™€ ì •ì‹  ê±´ê°• í–¥ìƒì— ë„ì›€ì´ ë©ë‹ˆë‹¤.'
            },
            'íŠ¸ë¼ìš°ë§ˆ': {
                term: 'íŠ¸ë¼ìš°ë§ˆ (Trauma)',
                description: 'ì‹¬ê°í•œ ì •ì‹ ì  ì¶©ê²©ì„ ì£¼ëŠ” ì‚¬ê±´ì´ë‚˜ ê²½í—˜. PTSD(ì™¸ìƒí›„ ìŠ¤íŠ¸ë ˆìŠ¤ ì¥ì• )ì™€ ê´€ë ¨ì´ ìˆìœ¼ë©°, ì „ë¬¸ì ì¸ ì¹˜ë£Œê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
            },
            'ìì¡´ê°': {
                term: 'ìì¡´ê° (Self-esteem)',
                description: 'ìì‹ ì— ëŒ€í•œ ì „ë°˜ì ì¸ í‰ê°€ì™€ ê°€ì¹˜ ì¸ì‹. ê±´ê°•í•œ ìì¡´ê°ì€ ì •ì‹  ê±´ê°•ì˜ ê¸°ì´ˆê°€ ë©ë‹ˆë‹¤.'
            },
            'ê³µê°': {
                term: 'ê³µê° (Empathy)',
                description: 'ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ê³¼ ê²½í—˜ì„ ì´í•´í•˜ê³  ê³µê°í•˜ëŠ” ëŠ¥ë ¥. ê±´ê°•í•œ ëŒ€ì¸ê´€ê³„ í˜•ì„±ì— ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤.'
            },
            'ë¶ˆì•ˆì¥ì• ': {
                term: 'ë¶ˆì•ˆì¥ì•  (Anxiety Disorder)',
                description: 'ê³¼ë„í•˜ê³  ì§€ì†ì ì¸ ë¶ˆì•ˆê³¼ ê±±ì •ì´ ì¼ìƒìƒí™œì— ì§€ì¥ì„ ì£¼ëŠ” ì •ì‹  ê±´ê°• ìƒíƒœ. ì¹˜ë£Œ ê°€ëŠ¥í•œ ì§ˆí™˜ì…ë‹ˆë‹¤.'
            },
            'ìš°ìš¸ì¦': {
                term: 'ìš°ìš¸ì¦ (Depression)',
                description: 'ì§€ì†ì ì¸ ìŠ¬í””, í¥ë¯¸ ìƒì‹¤, ì—ë„ˆì§€ ë¶€ì¡± ë“±ì˜ ì¦ìƒì´ ë‚˜íƒ€ë‚˜ëŠ” ì •ì‹  ê±´ê°• ìƒíƒœ. ì „ë¬¸ê°€ì˜ ë„ì›€ì´ í•„ìš”í•©ë‹ˆë‹¤.'
            },
            'íšŒë³µíƒ„ë ¥ì„±': {
                term: 'íšŒë³µíƒ„ë ¥ì„± (Resilience)',
                description: 'ì–´ë ¤ì›€ê³¼ ì—­ê²½ì„ ê²¬ë””ê³  íšŒë³µí•˜ëŠ” ëŠ¥ë ¥. ìŠ¤íŠ¸ë ˆìŠ¤ë‚˜ íŠ¸ë¼ìš°ë§ˆ ì´í›„ì—ë„ ì ì‘í•˜ê³  ì„±ì¥í•  ìˆ˜ ìˆëŠ” í˜ì…ë‹ˆë‹¤.'
            },
            'ìê¸°íš¨ëŠ¥ê°': {
                term: 'ìê¸°íš¨ëŠ¥ê° (Self-efficacy)',
                description: 'íŠ¹ì • ìƒí™©ì—ì„œ ìì‹ ì´ ì„±ê³µì ìœ¼ë¡œ í–‰ë™í•  ìˆ˜ ìˆë‹¤ëŠ” ë¯¿ìŒ. ëª©í‘œ ë‹¬ì„±ê³¼ ë™ê¸° ë¶€ì—¬ì— ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.'
            },
            'ì• ì°©': {
                term: 'ì• ì°© (Attachment)',
                description: 'íŠ¹ì • ì‚¬ëŒê³¼ í˜•ì„±í•˜ëŠ” ê°•í•œ ì •ì„œì  ìœ ëŒ€. ìœ ì•„ê¸° ì• ì°© íŒ¨í„´ì€ ì„±ì¸ê¸° ëŒ€ì¸ê´€ê³„ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.'
            },
            'ì¸ì§€ ì™œê³¡': {
                term: 'ì¸ì§€ ì™œê³¡ (Cognitive Distortion)',
                description: 'ë¹„í˜„ì‹¤ì ì´ê±°ë‚˜ ë¶€ì •ì ì¸ ì‚¬ê³  íŒ¨í„´. ì˜ˆ: í‘ë°±ì‚¬ê³ , ê³¼ë„í•œ ì¼ë°˜í™”, ê°ì •ì  ì¶”ë¡  ë“±.'
            },
            'ê°ì • ì¡°ì ˆ': {
                term: 'ê°ì • ì¡°ì ˆ (Emotion Regulation)',
                description: 'ê°ì •ì„ ì¸ì‹í•˜ê³  ì ì ˆí•˜ê²Œ ê´€ë¦¬í•˜ëŠ” ëŠ¥ë ¥. ê±´ê°•í•œ ê°ì • ì¡°ì ˆì€ ì •ì‹  ê±´ê°•ì˜ í•µì‹¬ì…ë‹ˆë‹¤.'
            },
            'ìŠ¤íŠ¸ë ˆìŠ¤': {
                term: 'ìŠ¤íŠ¸ë ˆìŠ¤ (Stress)',
                description: 'ì••ë°•ê°ì´ë‚˜ ë¶€ë‹´ì„ ëŠë¼ëŠ” ìƒíƒœ. ì ì ˆí•œ ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ë™ê¸° ë¶€ì—¬ê°€ ë˜ì§€ë§Œ, ê³¼ë„í•œ ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ê±´ê°•ì— í•´ë¡­ìŠµë‹ˆë‹¤.'
            },
            'ìƒë‹´': {
                term: 'ìƒë‹´ (Counseling)',
                description: 'ì „ë¬¸ê°€ì™€ì˜ ëŒ€í™”ë¥¼ í†µí•´ ì •ì„œì  ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì„±ì¥í•˜ëŠ” ê³¼ì •. ë¹„ë°€ë³´ì¥ì´ ë³´ì¥ë˜ëŠ” ì•ˆì „í•œ ê³µê°„ì…ë‹ˆë‹¤.'
            },
            'ì¹˜ë£Œ ë™ë§¹': {
                term: 'ì¹˜ë£Œ ë™ë§¹ (Therapeutic Alliance)',
                description: 'ì¹˜ë£Œìì™€ ë‚´ë‹´ì ê°„ì˜ ì‹ ë¢°ì™€ í˜‘ë ¥ ê´€ê³„. ì¹˜ë£Œ íš¨ê³¼ì— ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.'
            }
        };

        function loadDictionary(searchTerm = '') {
            const dictList = document.getElementById('dictionaryList');
            let items = Object.values(psychologyDictionary);
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                items = items.filter(item => 
                    item.term.toLowerCase().includes(term) || 
                    item.description.toLowerCase().includes(term)
                );
            }

            if (items.length === 0) {
                dictList.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            dictList.innerHTML = items.map(item => 
                `<div class="dictionary-item">
                    <h4>${item.term}</h4>
                    <p>${item.description}</p>
                </div>`
            ).join('');
        }

        function searchDictionary() {
            const searchTerm = document.getElementById('dictSearch').value;
            loadDictionary(searchTerm);
        }

        // í˜¸í¡ ìš´ë™
        let breathingInterval = null;
        let breathingPhase = 'in'; // 'in' or 'out'
        let breathingCount = 0;

        function startBreathing() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            const startBtn = document.getElementById('breathingBtn');
            const stopBtn = document.getElementById('stopBreathingBtn');
            
            startBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';
            breathingCount = 0;
            breathingPhase = 'in';

            breathingInterval = setInterval(() => {
                if (breathingPhase === 'in') {
                    circle.classList.add('breathing-in');
                    circle.classList.remove('breathing-out');
                    text.textContent = 'ë“¤ì–´ì‰¬ê¸°';
                    breathingPhase = 'out';
                } else {
                    circle.classList.remove('breathing-in');
                    circle.classList.add('breathing-out');
                    text.textContent = 'ë‚´ì‰¬ê¸°';
                    breathingPhase = 'in';
                    breathingCount++;
                }
            }, 4000); // 4ì´ˆë§ˆë‹¤ ì „í™˜
        }

        function stopBreathing() {
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
            }
            
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            const startBtn = document.getElementById('breathingBtn');
            const stopBtn = document.getElementById('stopBreathingBtn');
            
            circle.classList.remove('breathing-in', 'breathing-out');
            text.textContent = `ì™„ë£Œ (${breathingCount}íšŒ)`;
            startBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
        }

        // ì‹¬ë¦¬ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        const stressTestQuestions = [
            { q: 'ìµœê·¼ 2ì£¼ ë™ì•ˆ ë¶ˆì•ˆí•˜ê±°ë‚˜ ê±±ì •ë˜ëŠ” ì¼ì´ ë§ì•˜ë‚˜ìš”?', options: ['ì „í˜€ ì—†ìŒ', 'ê°€ë”', 'ìì£¼', 'ê±°ì˜ í•­ìƒ'] },
            { q: 'ìˆ˜ë©´ì— ë¬¸ì œê°€ ìˆì—ˆë‚˜ìš”?', options: ['ì „í˜€ ì—†ìŒ', 'ê°€ë”', 'ìì£¼', 'ê±°ì˜ í•­ìƒ'] },
            { q: 'ì§‘ì¤‘í•˜ê¸° ì–´ë ¤ì› ë‚˜ìš”?', options: ['ì „í˜€ ì—†ìŒ', 'ê°€ë”', 'ìì£¼', 'ê±°ì˜ í•­ìƒ'] },
            { q: 'í”¼ë¡œê°ì´ë‚˜ ì—ë„ˆì§€ ë¶€ì¡±ì„ ëŠê¼ˆë‚˜ìš”?', options: ['ì „í˜€ ì—†ìŒ', 'ê°€ë”', 'ìì£¼', 'ê±°ì˜ í•­ìƒ'] },
            { q: 'ì¼ìƒ í™œë™ì— ëŒ€í•œ ê´€ì‹¬ì´ë‚˜ ì¦ê±°ì›€ì´ ì¤„ì–´ë“¤ì—ˆë‚˜ìš”?', options: ['ì „í˜€ ì—†ìŒ', 'ê°€ë”', 'ìì£¼', 'ê±°ì˜ í•­ìƒ'] }
        ];

        const positivityTestQuestions = [
            { q: 'ë‚˜ëŠ” ê¸ì •ì ì¸ ì‚¬ê±´ì— ì§‘ì¤‘í•˜ëŠ” í¸ì´ë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ì–´ë ¤ìš´ ìƒí™©ì—ì„œë„ ê¸ì •ì ì¸ ì¸¡ë©´ì„ ì°¾ìœ¼ë ¤ê³  ë…¸ë ¥í•œë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ë¯¸ë˜ì— ëŒ€í•´ ë‚™ê´€ì ì¸ ìƒê°ì„ í•œë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ì‘ì€ ê²ƒì—ë„ ê°ì‚¬í•˜ëŠ” ë§ˆìŒì„ ê°–ëŠ”ë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ì‹¤íŒ¨ë¥¼ ë°°ì›€ì˜ ê¸°íšŒë¡œ ë³¸ë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] }
        ];

        const selfEsteemTestQuestions = [
            { q: 'ë‚˜ëŠ” ìì‹ ì˜ ê°€ì¹˜ë¥¼ ì¸ì •í•œë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ë‚˜ëŠ” ìì‹ ì˜ ê°•ì ì„ ì•Œê³  ìˆë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ë‚˜ëŠ” ì‹¤ìˆ˜ë¥¼ í•´ë„ ìì‹ ì„ ìš©ì„œí•  ìˆ˜ ìˆë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒê³¼ ë¹„êµí•˜ì§€ ì•Šìœ¼ë ¤ê³  ë…¸ë ¥í•œë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] },
            { q: 'ë‚˜ëŠ” ìì‹ ì˜ ì˜ê²¬ì„ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.', options: ['ì „í˜€ ì•„ë‹˜', 'ê°€ë”', 'ìì£¼', 'í•­ìƒ'] }
        ];

        let currentTest = null;
        let currentTestAnswers = [];
        let currentQuestionIndex = 0;

        function startStressTest() {
            currentTest = 'stress';
            currentTestAnswers = [];
            currentQuestionIndex = 0;
            renderTest('stressTestQuestions', stressTestQuestions);
            document.getElementById('startStressTestBtn').style.display = 'none';
        }

        function startPositivityTest() {
            currentTest = 'positivity';
            currentTestAnswers = [];
            currentQuestionIndex = 0;
            renderTest('positivityTestQuestions', positivityTestQuestions);
            document.getElementById('startPositivityTestBtn').style.display = 'none';
        }

        function startSelfEsteemTest() {
            currentTest = 'selfEsteem';
            currentTestAnswers = [];
            currentQuestionIndex = 0;
            renderTest('selfEsteemTestQuestions', selfEsteemTestQuestions);
            document.getElementById('startSelfEsteemTestBtn').style.display = 'none';
        }

        function renderTest(containerId, questions) {
            const container = document.getElementById(containerId);
            if (currentQuestionIndex >= questions.length) {
                showTestResult();
                return;
            }

            const question = questions[currentQuestionIndex];
            container.innerHTML = `
                <div style="margin: 20px 0; padding: 20px; background: white; border-radius: 8px;">
                    <p style="font-weight: 600; margin-bottom: 15px;">${currentQuestionIndex + 1}. ${question.q}</p>
                    ${question.options.map((opt, idx) => `
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                            <input type="radio" name="testAnswer" value="${idx}" onchange="answerQuestion(${idx})">
                            ${opt}
                        </label>
                    `).join('')}
                </div>
            `;
        }

        function answerQuestion(answerIndex) {
            currentTestAnswers.push(answerIndex);
            currentQuestionIndex++;
            
            const questions = currentTest === 'stress' ? stressTestQuestions :
                            currentTest === 'positivity' ? positivityTestQuestions :
                            selfEsteemTestQuestions;
            
            setTimeout(() => renderTest(
                currentTest === 'stress' ? 'stressTestQuestions' :
                currentTest === 'positivity' ? 'positivityTestQuestions' :
                'selfEsteemTestQuestions',
                questions
            ), 300);
        }

        function showTestResult() {
            const totalScore = currentTestAnswers.reduce((sum, ans) => sum + ans, 0);
            const maxScore = currentTestAnswers.length * 3;
            const percentage = Math.round((totalScore / maxScore) * 100);
            
            let resultText = '';
            let resultColor = '';
            
            if (currentTest === 'stress') {
                if (percentage < 30) {
                    resultText = 'ë‚®ì€ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì…ë‹ˆë‹¤. í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ ì˜ ë˜ê³  ìˆìŠµë‹ˆë‹¤.';
                    resultColor = '#28a745';
                } else if (percentage < 60) {
                    resultText = 'ë³´í†µ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì…ë‹ˆë‹¤. ê·œì¹™ì ì¸ íœ´ì‹ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë°©ë²•ì„ ì‹¤ì²œí•´ë³´ì„¸ìš”.';
                    resultColor = '#ffc107';
                } else {
                    resultText = 'ë†’ì€ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì…ë‹ˆë‹¤. ì „ë¬¸ê°€ ìƒë‹´ì„ ê³ ë ¤í•˜ê±°ë‚˜ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë°©ë²•ì„ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•´ë³´ì„¸ìš”.';
                    resultColor = '#dc3545';
                }
            } else if (currentTest === 'positivity') {
                if (percentage > 70) {
                    resultText = 'ë§¤ìš° ê¸ì •ì ì¸ ì‚¬ê³ ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê¸ì •ì„±ì„ ìœ ì§€í•˜ì„¸ìš”!';
                    resultColor = '#28a745';
                } else if (percentage > 40) {
                    resultText = 'ë³´í†µ ìˆ˜ì¤€ì˜ ê¸ì •ì„±ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ê¸ì •ì  ì‚¬ê³ ë¥¼ ë” ì—°ìŠµí•´ë³´ì„¸ìš”.';
                    resultColor = '#ffc107';
                } else {
                    resultText = 'ê¸ì •ì  ì‚¬ê³ ë¥¼ í–¥ìƒì‹œí‚¬ ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤. ê°ì‚¬ ì¼ê¸°ë‚˜ ê¸ì •ì  ìê¸° ëŒ€í™”ë¥¼ ì‹¤ì²œí•´ë³´ì„¸ìš”.';
                    resultColor = '#dc3545';
                }
            } else {
                if (percentage > 70) {
                    resultText = 'ê±´ê°•í•œ ìì¡´ê°ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ìì‹ ì„ ì†Œì¤‘íˆ ì—¬ê¸°ëŠ” ë§ˆìŒì„ ìœ ì§€í•˜ì„¸ìš”.';
                    resultColor = '#28a745';
                } else if (percentage > 40) {
                    resultText = 'ë³´í†µ ìˆ˜ì¤€ì˜ ìì¡´ê°ì…ë‹ˆë‹¤. ìì‹ ì˜ ê°•ì ì„ ì¸ì‹í•˜ê³  ê¸ì •ì  ìê¸° ëŒ€í™”ë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”.';
                    resultColor = '#ffc107';
                } else {
                    resultText = 'ìì¡´ê° í–¥ìƒì´ í•„ìš”í•©ë‹ˆë‹¤. ì‘ì€ ì„±ì·¨ë¥¼ ì¸ì •í•˜ê³  ìì‹ ì—ê²Œ ì¹œì ˆí•˜ê²Œ ëŒ€í•˜ì„¸ìš”.';
                    resultColor = '#dc3545';
                }
            }

            const resultDiv = document.getElementById(
                currentTest === 'stress' ? 'stressTestResult' :
                currentTest === 'positivity' ? 'positivityTestResult' :
                'selfEsteemTestResult'
            );
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h4 style="color: ${resultColor}; margin-bottom: 15px;">í…ŒìŠ¤íŠ¸ ê²°ê³¼</h4>
                <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 15px;">${resultText}</p>
                <p style="color: #666;">ì ìˆ˜: ${totalScore}/${maxScore} (${percentage}%)</p>
                <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 15px;">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
            `;
        }

        // ìê¸° ëŒ€í™” ë¶„ì„
        function analyzeSelfTalk() {
            const text = document.getElementById('selfTalkInput').value.trim();
            if (!text) {
                alert('ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const negativePatterns = {
                'í•­ìƒ': 'ê³¼ë„í•œ ì¼ë°˜í™”',
                'ì ˆëŒ€': 'í‘ë°±ì‚¬ê³ ',
                'ëª¨ë‘': 'ê³¼ë„í•œ ì¼ë°˜í™”',
                'ì•„ë¬´ë„': 'ê³¼ë„í•œ ì¼ë°˜í™”',
                'ì‹¤íŒ¨': 'ë¶€ì •ì  ë¼ë²¨ë§',
                'ëª»í•´': 'ìê¸° ë¹„í•˜',
                'ê°€ì¹˜ ì—†': 'ìê¸° ë¹„í•˜',
                'ë¬´ëŠ¥': 'ìê¸° ë¹„í•˜',
                'ë°”ë³´': 'ìê¸° ë¹„í•˜',
                'ì“¸ëª¨ ì—†': 'ìê¸° ë¹„í•˜'
            };

            const detectedPatterns = [];
            const suggestions = [];
            const alternatives = [];

            for (const [keyword, pattern] of Object.entries(negativePatterns)) {
                if (text.includes(keyword)) {
                    detectedPatterns.push(pattern);
                }
            }

            if (detectedPatterns.length === 0) {
                detectedPatterns.push('ë¶€ì •ì  íŒ¨í„´ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }

            // ê°œì„  ì œì•ˆ
            if (text.includes('í•­ìƒ') || text.includes('ì ˆëŒ€')) {
                suggestions.push('"í•­ìƒ", "ì ˆëŒ€" ê°™ì€ ê·¹ë‹¨ì  í‘œí˜„ì„ í”¼í•˜ê³  êµ¬ì²´ì ì¸ ìƒí™©ì„ ì„¤ëª…í•´ë³´ì„¸ìš”.');
            }
            if (text.includes('ì‹¤íŒ¨') || text.includes('ëª»í•´')) {
                suggestions.push('ì‹¤ìˆ˜ë¥¼ ë°°ì›€ì˜ ê¸°íšŒë¡œ ë³´ëŠ” ê´€ì ì„ ì—°ìŠµí•´ë³´ì„¸ìš”.');
            }
            if (text.includes('ê°€ì¹˜ ì—†') || text.includes('ë¬´ëŠ¥')) {
                suggestions.push('ìì‹ ì˜ ê°•ì ê³¼ ì„±ì·¨ë¥¼ ì¸ì‹í•˜ê³  ê¸ì •ì  ìê¸° ëŒ€í™”ë¥¼ ì‹¤ì²œí•´ë³´ì„¸ìš”.');
            }

            // ê¸ì •ì  ëŒ€ì•ˆ
            let positiveText = text;
            positiveText = positiveText.replace(/ë‚˜ëŠ” í•­ìƒ ì‹¤ìˆ˜ë§Œ í•´/g, 'ë‚˜ëŠ” ë•Œë•Œë¡œ ì‹¤ìˆ˜ë¥¼ í•˜ì§€ë§Œ ë°°ìš¸ ìˆ˜ ìˆì–´');
            positiveText = positiveText.replace(/ë‚˜ëŠ” ê°€ì¹˜ ì—†ëŠ” ì‚¬ëŒì´ì•¼/g, 'ë‚˜ëŠ” ë‚˜ë§Œì˜ ê°€ì¹˜ê°€ ìˆëŠ” ì‚¬ëŒì´ì•¼');
            positiveText = positiveText.replace(/ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ ë‹¤ ì˜í•˜ëŠ”ë° ë‚˜ë§Œ ëª»í•´/g, 'ê°ì ë‹¤ë¥¸ ì†ë„ë¡œ ì„±ì¥í•˜ê³  ìˆì–´');
            positiveText = positiveText.replace(/í•­ìƒ/g, 'ë•Œë•Œë¡œ');
            positiveText = positiveText.replace(/ì ˆëŒ€/g, 'ê±°ì˜');

            if (positiveText === text) {
                alternatives.push('ê¸ì •ì ì¸ ê´€ì ìœ¼ë¡œ ë‹¤ì‹œ í‘œí˜„í•´ë³´ì„¸ìš”.');
            } else {
                alternatives.push(`"${positiveText}"`);
            }

            document.getElementById('selfTalkResult').innerHTML = `
                <p><strong>ê°ì§€ëœ íŒ¨í„´:</strong> ${[...new Set(detectedPatterns)].join(', ')}</p>
                <p style="margin-top: 10px;"><strong>ë¶€ì •ì  í‘œí˜„:</strong> ${detectedPatterns.length}ê°œ</p>
            `;
            
            document.getElementById('selfTalkSuggestions').innerHTML = suggestions.length > 0 
                ? suggestions.map(s => `<p>â€¢ ${s}</p>`).join('')
                : '<p>ê¸ì •ì ì¸ ìê¸° ëŒ€í™”ë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>';
            
            document.getElementById('selfTalkAlternatives').innerHTML = alternatives.map(a => `<p>${a}</p>`).join('');
            document.getElementById('selfTalkAnalysis').style.display = 'block';
        }

        // ê°ì • íŒ¨í„´ ë¶„ì„
        function loadPatternAnalysis() {
            const diaries = JSON.parse(localStorage.getItem('gpt_keyboard_diaries') || '[]');
            
            if (diaries.length === 0) {
                document.getElementById('patternInsights').innerHTML = '<p style="padding: 20px; text-align: center; color: #999;">ê°ì • ì¼ê¸° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì¼ê¸°ë¥¼ ì‘ì„±í•˜ë©´ íŒ¨í„´ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>';
                return;
            }

            // ì¸ì‚¬ì´íŠ¸
            const emotionCount = {};
            diaries.forEach(d => {
                emotionCount[d.emotion] = (emotionCount[d.emotion] || 0) + 1;
            });
            const mostEmotion = Object.entries(emotionCount).sort((a, b) => b[1] - a[1])[0];
            
            document.getElementById('patternInsights').innerHTML = `
                <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
                    <h4 style="margin-bottom: 15px;">ğŸ’¡ ì£¼ìš” ì¸ì‚¬ì´íŠ¸</h4>
                    <p>ê°€ì¥ ìì£¼ ê¸°ë¡ëœ ê°ì •: <strong>${mostEmotion[0]}</strong> (${mostEmotion[1]}íšŒ)</p>
                    <p style="margin-top: 10px;">ì´ ì¼ê¸° ìˆ˜: <strong>${diaries.length}ê°œ</strong></p>
                </div>
            `;

            // ìš”ì¼ë³„ íŒ¨í„´
            const weeklyEmotions = {};
            diaries.forEach(d => {
                const date = new Date(d.timestamp);
                const day = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
                if (!weeklyEmotions[day]) weeklyEmotions[day] = {};
                weeklyEmotions[day][d.emotion] = (weeklyEmotions[day][d.emotion] || 0) + 1;
            });

            document.getElementById('weeklyPattern').innerHTML = Object.entries(weeklyEmotions)
                .map(([day, emotions]) => {
                    const mainEmotion = Object.entries(emotions).sort((a, b) => b[1] - a[1])[0];
                    return `<div style="padding: 10px; margin: 5px 0; background: white; border-radius: 8px;">
                        <strong>${day}ìš”ì¼</strong>: ${mainEmotion ? mainEmotion[0] : '-'} (${mainEmotion ? mainEmotion[1] : 0}íšŒ)
                    </div>`;
                }).join('') || '<p style="color: #999;">ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>';

            // ê°ì • ì¶”ì´
            const recentDiaries = diaries.slice(-30).reverse();
            document.getElementById('emotionTrendChart').innerHTML = recentDiaries
                .map(d => `<div style="padding: 10px; margin: 5px 0; background: white; border-radius: 8px; display: flex; justify-content: space-between;">
                    <span>${d.date}</span>
                    <span style="font-weight: 600; color: #667eea;">${d.emotion}</span>
                </div>`).join('') || '<p style="color: #999;">ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>';

            // íŠ¸ë¦¬ê±° ë¶„ì„ (í‚¤ì›Œë“œ ê¸°ë°˜)
            const triggerWords = ['ì¼', 'ì¼ìƒ', 'ì¹œêµ¬', 'ê°€ì¡±', 'ì¼', 'ê³µë¶€', 'ìŠ¤íŠ¸ë ˆìŠ¤', 'ê±±ì •'];
            const triggers = {};
            diaries.forEach(d => {
                triggerWords.forEach(word => {
                    if (d.content.includes(word)) {
                        triggers[word] = (triggers[word] || 0) + 1;
                    }
                });
            });

            document.getElementById('emotionTriggers').innerHTML = Object.entries(triggers)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([word, count]) => `<div style="padding: 10px; margin: 5px 0; background: white; border-radius: 8px;">
                    <strong>${word}</strong>: ${count}íšŒ ì–¸ê¸‰
                </div>`).join('') || '<p style="color: #999;">íŠ¸ë¦¬ê±° íŒ¨í„´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ëª©í‘œ ì„¤ì •
        function addGoal() {
            const title = document.getElementById('goalTitle').value.trim();
            const description = document.getElementById('goalDescription').value.trim();
            const type = document.getElementById('goalType').value;
            const deadline = document.getElementById('goalDeadline').value;

            if (!title) {
                alert('ëª©í‘œ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const goals = JSON.parse(localStorage.getItem('gpt_keyboard_goals') || '[]');
            const newGoal = {
                id: Date.now().toString(),
                title,
                description,
                type,
                deadline,
                createdAt: new Date().toISOString(),
                completed: false
            };

            goals.push(newGoal);
            localStorage.setItem('gpt_keyboard_goals', JSON.stringify(goals));

            document.getElementById('goalTitle').value = '';
            document.getElementById('goalDescription').value = '';
            document.getElementById('goalDeadline').value = '';

            loadGoals();
        }

        function loadGoals() {
            const goals = JSON.parse(localStorage.getItem('gpt_keyboard_goals') || '[]');
            const goalsList = document.getElementById('goalsList');

            if (goals.length === 0) {
                goalsList.innerHTML = '<p style="padding: 20px; text-align: center; color: #999;">ì„¤ì •í•œ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            goalsList.innerHTML = goals.map(goal => {
                const daysLeft = goal.deadline ? Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24)) : null;
                return `
                    <div style="padding: 20px; margin-bottom: 15px; background: ${goal.completed ? '#d4edda' : '#f8f9fa'}; border-radius: 12px; border-left: 4px solid ${goal.completed ? '#28a745' : '#667eea'};">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h4 style="margin-bottom: 10px; ${goal.completed ? 'text-decoration: line-through;' : ''}">${goal.title}</h4>
                                <p style="color: #666; margin-bottom: 10px;">${goal.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                                <div style="font-size: 0.9em; color: #999;">
                                    <span>ìœ í˜•: ${getGoalTypeName(goal.type)}</span>
                                    ${goal.deadline ? ` | ë§ˆê°: ${goal.deadline} ${daysLeft !== null ? (daysLeft > 0 ? `(${daysLeft}ì¼ ë‚¨ìŒ)` : '(ê¸°í•œ ì§€ë‚¨)') : ''}` : ''}
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-secondary" onclick="toggleGoal('${goal.id}')" style="margin-left: 10px;">
                                    ${goal.completed ? 'ë¯¸ì™„ë£Œ' : 'ì™„ë£Œ'}
                                </button>
                                <button class="btn btn-secondary" onclick="deleteGoal('${goal.id}')" style="margin-left: 5px;">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getGoalTypeName(type) {
            const types = {
                'mental': 'ì •ì‹  ê±´ê°•',
                'emotional': 'ê°ì • ê´€ë¦¬',
                'social': 'ì‚¬íšŒì„±',
                'selfcare': 'ìê¸° ëŒë´„',
                'growth': 'ì„±ì¥',
                'other': 'ê¸°íƒ€'
            };
            return types[type] || type;
        }

        function toggleGoal(id) {
            const goals = JSON.parse(localStorage.getItem('gpt_keyboard_goals') || '[]');
            const goal = goals.find(g => g.id === id);
            if (goal) {
                goal.completed = !goal.completed;
                localStorage.setItem('gpt_keyboard_goals', JSON.stringify(goals));
                loadGoals();
            }
        }

        function deleteGoal(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const goals = JSON.parse(localStorage.getItem('gpt_keyboard_goals') || '[]');
                const filtered = goals.filter(g => g.id !== id);
                localStorage.setItem('gpt_keyboard_goals', JSON.stringify(filtered));
                loadGoals();
            }
        }

        // ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬
        function updateStressLevel(value) {
            document.getElementById('stressValue').textContent = value;
            
            let description = '';
            let color = '';
            if (value <= 3) {
                description = 'ë‚®ì€ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì…ë‹ˆë‹¤. í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ì„¸ìš”.';
                color = '#28a745';
            } else if (value <= 6) {
                description = 'ë³´í†µ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì…ë‹ˆë‹¤. ê·œì¹™ì ì¸ íœ´ì‹ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë°©ë²•ì„ ì‹¤ì²œí•´ë³´ì„¸ìš”.';
                color = '#ffc107';
            } else {
                description = 'ë†’ì€ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì…ë‹ˆë‹¤. ì¶©ë¶„í•œ íœ´ì‹ê³¼ ì „ë¬¸ê°€ ìƒë‹´ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.';
                color = '#dc3545';
            }

            document.getElementById('stressDescription').innerHTML = `
                <p style="color: ${color}; font-weight: 600; margin: 0;">${description}</p>
            `;

            loadStressManagementTips(value);
        }

        function loadStressManagementTips(level) {
            const tips = [];
            if (level <= 3) {
                tips.push('í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ ì˜ ë˜ê³  ìˆìŠµë‹ˆë‹¤.');
                tips.push('ê·œì¹™ì ì¸ ìš´ë™ê³¼ ìˆ˜ë©´ì„ ìœ ì§€í•˜ì„¸ìš”.');
                tips.push('ê¸ì •ì ì¸ í™œë™ì„ ê³„ì†í•˜ì„¸ìš”.');
            } else if (level <= 6) {
                tips.push('ê¹Šì€ í˜¸í¡ ìš´ë™ì„ ì‹¤ì²œí•´ë³´ì„¸ìš”.');
                tips.push('ê·œì¹™ì ì¸ íœ´ì‹ ì‹œê°„ì„ ê°€ì§€ì„¸ìš”.');
                tips.push('ê°€ë²¼ìš´ ìš´ë™ì´ë‚˜ ì‚°ì±…ì„ í•´ë³´ì„¸ìš”.');
                tips.push('ë§ˆìŒì±™ê¹€ ëª…ìƒì„ ì‹œë„í•´ë³´ì„¸ìš”.');
            } else {
                tips.push('ì¶©ë¶„í•œ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”.');
                tips.push('ì „ë¬¸ê°€ ìƒë‹´ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.');
                tips.push('ê·œì¹™ì ì¸ ìˆ˜ë©´ íŒ¨í„´ì„ ìœ ì§€í•˜ì„¸ìš”.');
                tips.push('ìŠ¤íŠ¸ë ˆìŠ¤ ì›ì¸ì„ íŒŒì•…í•˜ê³  í•´ê²° ë°©ë²•ì„ ì°¾ì•„ë³´ì„¸ìš”.');
                tips.push('ì‚¬íšŒì  ì§€ì§€ ë„¤íŠ¸ì›Œí¬ë¥¼ í™œìš©í•˜ì„¸ìš”.');
            }

            document.getElementById('stressManagementTips').innerHTML = tips.map(tip => 
                `<div style="padding: 10px; margin: 5px 0; background: white; border-radius: 8px;">â€¢ ${tip}</div>`
            ).join('');
        }

        function saveStressRecord() {
            const level = document.getElementById('stressLevel').value;
            const cause = document.getElementById('stressCause').value.trim();
            
            if (!cause) {
                alert('ìŠ¤íŠ¸ë ˆìŠ¤ ì›ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const records = JSON.parse(localStorage.getItem('gpt_keyboard_stress') || '[]');
            records.push({
                level: parseInt(level),
                cause,
                date: new Date().toLocaleDateString('ko-KR'),
                timestamp: new Date().toISOString()
            });

            localStorage.setItem('gpt_keyboard_stress', JSON.stringify(records));
            document.getElementById('stressCause').value = '';
            loadStressHistory();
        }

        function loadStressHistory() {
            const records = JSON.parse(localStorage.getItem('gpt_keyboard_stress') || '[]');
            const historyDiv = document.getElementById('stressHistory');

            if (records.length === 0) {
                historyDiv.innerHTML = '<p style="color: #999;">ê¸°ë¡ëœ ìŠ¤íŠ¸ë ˆìŠ¤ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const recentRecords = records.slice(-10).reverse();
            historyDiv.innerHTML = recentRecords.map(r => {
                let levelColor = '#28a745';
                if (r.level > 6) levelColor = '#dc3545';
                else if (r.level > 3) levelColor = '#ffc107';

                return `
                    <div style="padding: 15px; margin: 10px 0; background: white; border-radius: 8px; border-left: 4px solid ${levelColor};">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span><strong>${r.date}</strong></span>
                            <span style="color: ${levelColor}; font-weight: 600;">ë ˆë²¨ ${r.level}/10</span>
                        </div>
                        <p style="color: #666; margin: 0;">${r.cause}</p>
                    </div>
                `;
            }).join('');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            loadDiaries();
            loadStats();
            loadDictionary();
            loadGoals();
            loadStressHistory();
            updateStressLevel(5);
            
            // íŒ¨í„´ ë¶„ì„ íƒ­ì´ í™œì„±í™”ë  ë•Œ ë¡œë“œ
            const patternTab = document.getElementById('pattern');
            if (patternTab) {
                const observer = new MutationObserver(() => {
                    if (patternTab.classList.contains('active')) {
                        loadPatternAnalysis();
                    }
                });
                observer.observe(patternTab, { attributes: true, attributeFilter: ['class'] });
            }
        });
    </script>
</body>
</html>

